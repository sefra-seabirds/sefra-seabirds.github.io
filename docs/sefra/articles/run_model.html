<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Run SEFRA model • sefra</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run SEFRA model">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sefra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/run_model.html">Run SEFRA model</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sefra-seabirds/sefra/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Run SEFRA model</h1>
                        <h4 data-toc-skip class="author">Charles Edwards
and Tom Peatman</h4>
            
            <h4 data-toc-skip class="date">31 Dec 2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sefra-seabirds/sefra/blob/HEAD/vignettes/run_model.Rmd" class="external-link"><code>vignettes/run_model.Rmd</code></a></small>
      <div class="d-none name"><code>run_model.Rmd</code></div>
    </div>

    
    
<p>Load packages required for data preparation:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sefra-seabirds/sefra" class="external-link">sefra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sefra-seabirds/sefraInputs" class="external-link">sefraInputs</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="prelims">Prelims<a class="anchor" aria-label="anchor" href="#prelims"></a>
</h2>
<p>Source data from <code>sefraInputs</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/sefraInputs/man/sefra_data.html" class="external-link">sefra_data</a></span><span class="op">(</span><span class="st">"inputsBio"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loaded data:</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |name      |description |created             |version                | id|</span></span>
<span><span class="co">## |:---------|:-----------|:-------------------|:----------------------|--:|</span></span>
<span><span class="co">## |inputsBio |reference   |2025-03-27 11:25:55 |20250327T112555Z-ed41c |  2|</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/sefraInputs/man/sefra_data.html" class="external-link">sefra_data</a></span><span class="op">(</span><span class="st">"cryptic_capture_longline"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loaded data:</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |name                     |description |created             |version                | id|</span></span>
<span><span class="co">## |:------------------------|:-----------|:-------------------|:----------------------|--:|</span></span>
<span><span class="co">## |cryptic_capture_longline |reference   |2025-03-27 11:25:55 |20250327T112555Z-240cc |  1|</span></span></code></pre>
<p>Extract biological data for <code>reference</code> case:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import demographic data</span></span>
<span><span class="va">N_BP</span>       <span class="op">&lt;-</span> <span class="va">inputsBio</span><span class="op">[[</span><span class="st">"N_BP"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">S_opt</span>      <span class="op">&lt;-</span> <span class="va">inputsBio</span><span class="op">[[</span><span class="st">"S_opt"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">A_curr</span>     <span class="op">&lt;-</span> <span class="va">inputsBio</span><span class="op">[[</span><span class="st">"A_curr"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">P_B</span>        <span class="op">&lt;-</span> <span class="va">inputsBio</span><span class="op">[[</span><span class="st">"P_B"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">P_nest</span>     <span class="op">&lt;-</span> <span class="va">inputsBio</span><span class="op">[[</span><span class="st">"p_nest"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">P_southern</span> <span class="op">&lt;-</span> <span class="va">inputsBio</span><span class="op">[[</span><span class="st">"p_southern"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-sefradata-object">The <code>sefraData</code> object<a class="anchor" aria-label="anchor" href="#the-sefradata-object"></a>
</h2>
<p>Data are stored in a <code>S4</code> object of class
<code>sefraData</code>. The <code>sefraData</code> object is a list with
pre-defined components. When assigning data to this list, checks are
made during the assignment to ensure the data are in the correct format
for model input. The <code>sefraData</code> object is initialised using
a call to <code>sefraData(&lt;species&gt;, &lt;identifier&gt;)</code>. A
vector of species must be supplied (see <code><a href="../reference/species.html">?species</a></code> for a list
of those available). By defining the species, all subsequent assignments
can be checked for consistency with this species list. An
<code>identifier</code> argument is also allowed, so that different data
configurations can be labelled. In this vignette, we demonstrate how an
<code>sefraData</code> object can be populated and input to a model
run.</p>
<p>First, initialise the data object using three example species:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sefra_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sefraData-class.html">sefraData</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'DIW'</span>, <span class="st">'DQS'</span>, <span class="st">'TWD'</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"reference"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## species codes input: including all species-dependent capture codes</span></span></code></pre>
<pre><code><span><span class="co">## constructed 'sefraData' object</span></span></code></pre>
<p>When choosing the species we are assuming that all captures are from
one of these species, even if the capture code recorded in the capture
data refers to a lower taxonomic resolution. In the example below,
captures are also recorded using the generic <code>BLZ</code> code. The
model will assume that genus-, family- or generic-level captures are of
<code>DIW</code>, <code>DQS</code> or <code>TWD</code>; i.e., when
fitting to the data the captures will be predicted from the fishery
overlap with these species only. If generic captures could be of other
species not recorded at the species level, then these species should be
included in the <code>sefraData</code> object. In which case the model
will select a zero probability of observation for that species.</p>
<p>Following initialisation of the <code>sefraData</code> object, the
species names are available using the accessor function:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/species_names.html">species_names</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Species</span></span></code></pre>
<pre><code><span><span class="co">##    code                        common_name                    scientific_name</span></span>
<span><span class="co">## 1   DIW                 Gibson's albatross      Diomedea antipodensis gibsoni</span></span>
<span><span class="co">## 2   DQS               Antipodean albatross Diomedea antipodensis antipodensis</span></span>
<span><span class="co">## 13  TWD New Zealand white-capped albatross          Thalassarche cauta steadi</span></span>
<span><span class="co">##           genus      family code_resolution id_species</span></span>
<span><span class="co">## 1      Diomedea Diomedeidae         species          1</span></span>
<span><span class="co">## 2      Diomedea Diomedeidae         species          2</span></span>
<span><span class="co">## 13 Thalassarche Diomedeidae         species         13</span></span></code></pre>
<p>which can be useful for labeling plots of model diagnostics. Note
that the <code>id_species</code> corresponds to the order recorded in
<code><a href="../reference/species.html">?species</a></code>. This numbering is retained throughout, allowing
the data inputs and model outputs to be matched consistently to the
species.</p>
<p>The relevant capture codes are automatically generated from the list
of species, and will include the species-level capture codes, but also
lower level taxonomic codes. In the current example:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/capture_codes.html">capture_codes</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 10 capture codes:</span></span></code></pre>
<pre><code><span><span class="co">## (empty captures data frame)</span></span></code></pre>
<pre><code><span><span class="co">##    code id_code resolution id_resolution</span></span>
<span><span class="co">## 1   DIW       1    species             1</span></span>
<span><span class="co">## 2   DQS       2    species             1</span></span>
<span><span class="co">## 3   TWD      13    species             1</span></span>
<span><span class="co">## 4   DGA      26    complex             2</span></span>
<span><span class="co">## 5   DST      29    complex             2</span></span>
<span><span class="co">## 6   DWC      32    complex             2</span></span>
<span><span class="co">## 7   DIZ      34      genus             3</span></span>
<span><span class="co">## 8   THZ      35      genus             3</span></span>
<span><span class="co">## 9   ALZ      38     family             4</span></span>
<span><span class="co">## 10  BLZ      40      class             5</span></span></code></pre>
<div class="section level3">
<h3 id="assign-biological-data">Assign biological data<a class="anchor" aria-label="anchor" href="#assign-biological-data"></a>
</h3>
<p>From the <code>inputsBio</code> data accessed using
<code><a href="https://rdrr.io/pkg/sefraInputs/man/sefra_data.html" class="external-link">sefraInputs::sefra_data()</a></code>, we assign these to the
<code>sefraData</code> object. Assignment functions are provided for
each data type, and automatically select the required species:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/n_breeding_pairs.html">n_breeding_pairs</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">N_BP</span>       </span>
<span><span class="fu"><a href="../reference/adult_survival.html">adult_survival</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span>   <span class="op">&lt;-</span> <span class="va">S_opt</span>      </span>
<span><span class="fu"><a href="../reference/p_breeding.html">p_breeding</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span>       <span class="op">&lt;-</span> <span class="va">P_B</span>        </span>
<span><span class="fu"><a href="../reference/age_breeding.html">age_breeding</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span>     <span class="op">&lt;-</span> <span class="va">A_curr</span>     </span>
<span><span class="fu"><a href="../reference/p_nest.html">p_nest</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span>           <span class="op">&lt;-</span> <span class="va">P_nest</span></span>
<span><span class="fu"><a href="../reference/p_southern.html">p_southern</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span>       <span class="op">&lt;-</span> <span class="va">P_southern</span></span></code></pre></div>
<p>Biological inputs for the number of breeding pairs, the adult
survival, the probability of breeding, and the age at first breeding
should be provided as two-parameter probability density functions. These
can be one of: <code>uniform</code>, <code>beta</code>,
<code>normal</code>, <code>log-normal</code> or
<code>logit-normal</code> (see <code><a href="../reference/distributions.html">?distributions</a></code>). The input
data frame must contain the column headers <code>distribution</code>,
<code>par1</code> and <code>par2</code>.</p>
<p>We can view the input data using, for example:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N_BP</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id_species</span>, <span class="va">code</span>, <span class="va">distribution</span>, <span class="va">par1</span>, <span class="va">par2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    id_species code distribution       par1      par2</span></span>
<span><span class="co">## 1           1  DIW   log-normal    4425.00     0.050</span></span>
<span><span class="co">## 2           2  DQS   log-normal    3383.00     0.050</span></span>
<span><span class="co">## 3           3  DIX   log-normal   10130.00     0.050</span></span>
<span><span class="co">## 4           4  DBN      weibull       9.25  1710.000</span></span>
<span><span class="co">## 5           5  DAM   log-normal      60.00     0.100</span></span>
<span><span class="co">## 6           6  DIP   log-normal    5814.00     0.070</span></span>
<span><span class="co">## 7           7  DIQ   log-normal    4261.00     0.110</span></span>
<span><span class="co">## 8           8  DCR   log-normal   26800.00     0.100</span></span>
<span><span class="co">## 9           9  TQH   log-normal   33988.00     0.100</span></span>
<span><span class="co">## 10         10  DIM   log-normal  670960.00     0.050</span></span>
<span><span class="co">## 11         11  TQW   log-normal   14129.00     0.050</span></span>
<span><span class="co">## 12         12  DCU   log-normal   15335.00     0.100</span></span>
<span><span class="co">## 13         13  TWD   log-normal   85820.00     0.120</span></span>
<span><span class="co">## 14         14  DKS   log-normal   35242.00     0.050</span></span>
<span><span class="co">## 15         15  DER   log-normal    5294.00     0.010</span></span>
<span><span class="co">## 16         16  DIC   log-normal   63055.00     0.050</span></span>
<span><span class="co">## 17         17  DSB   log-normal   13493.00     0.050</span></span>
<span><span class="co">## 18         18  DNB   log-normal   19354.00     0.050</span></span>
<span><span class="co">## 19         19  PHU      weibull      23.20 13660.000</span></span>
<span><span class="co">## 20         20  PHE   log-normal   20927.00     0.100</span></span>
<span><span class="co">## 21         21  PCI   log-normal  105617.00     0.150</span></span>
<span><span class="co">## 22         22  PRK   log-normal    5456.00     0.057</span></span>
<span><span class="co">## 23         23  PCW   log-normal    6223.00     0.061</span></span>
<span><span class="co">## 24         24  PRO   log-normal 1317300.00     0.100</span></span>
<span><span class="co">## 25         25  PCN   log-normal   42000.00     0.096</span></span></code></pre>
<p>The assigned model values are:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/n_breeding_pairs.html">n_breeding_pairs</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     distribution  par1 par2</span></span>
<span><span class="co">## DIW   log-normal  4425 0.05</span></span>
<span><span class="co">## DQS   log-normal  3383 0.05</span></span>
<span><span class="co">## TWD   log-normal 85820 0.12</span></span></code></pre>
<p>Similarly:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">P_B</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id_species</span>, <span class="va">code</span>, <span class="va">distribution</span>, <span class="va">par1</span>, <span class="va">par2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    id_species code distribution  par1    par2</span></span>
<span><span class="co">## 1           1  DIW         beta 0.595  170.00</span></span>
<span><span class="co">## 2           2  DQS         beta 0.450   91.30</span></span>
<span><span class="co">## 3           3  DIX logit-normal 0.494    0.05</span></span>
<span><span class="co">## 4           4  DBN         beta 0.349   51.30</span></span>
<span><span class="co">## 5           5  DAM logit-normal 0.600    0.05</span></span>
<span><span class="co">## 6           6  DIP         beta 0.531   22.20</span></span>
<span><span class="co">## 7           7  DIQ         beta 0.531   22.20</span></span>
<span><span class="co">## 8           8  DCR         beta 0.596 4100.00</span></span>
<span><span class="co">## 9           9  TQH logit-normal 0.596    0.05</span></span>
<span><span class="co">## 10         10  DIM         beta 0.844  174.00</span></span>
<span><span class="co">## 11         11  TQW logit-normal 0.900    0.05</span></span>
<span><span class="co">## 12         12  DCU logit-normal 0.747    0.05</span></span>
<span><span class="co">## 13         13  TWD         beta 0.680   63.90</span></span>
<span><span class="co">## 14         14  DKS         beta 0.821   29.70</span></span>
<span><span class="co">## 15         15  DER logit-normal 0.773    0.05</span></span>
<span><span class="co">## 16         16  DIC         beta 0.406   17.50</span></span>
<span><span class="co">## 17         17  DSB         beta 0.804   34.90</span></span>
<span><span class="co">## 18         18  DNB logit-normal 0.800    0.05</span></span>
<span><span class="co">## 19         19  PHU logit-normal 0.730    0.05</span></span>
<span><span class="co">## 20         20  PHE         beta 0.730   15.80</span></span>
<span><span class="co">## 21         21  PCI logit-normal 0.900    0.05</span></span>
<span><span class="co">## 22         22  PRK         beta 0.610  143.00</span></span>
<span><span class="co">## 23         23  PCW         beta 0.480   45.40</span></span>
<span><span class="co">## 24         24  PRO logit-normal 0.750    0.05</span></span>
<span><span class="co">## 25         25  PCN logit-normal 0.797    0.05</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/p_breeding.html">p_breeding</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     distribution  par1  par2</span></span>
<span><span class="co">## DIW         beta 0.595 170.0</span></span>
<span><span class="co">## DQS         beta 0.450  91.3</span></span>
<span><span class="co">## TWD         beta 0.680  63.9</span></span></code></pre>
<p>If you wish to use alternate biological data values, please provide
these directly to the project team for inclusion in the
<code>sefraInputs</code> package. This will ensure they are available to
all participants. Centralisation of the data inputs further allows for
consistent cross referencing of different data supplied to different
model runs.</p>
</div>
<div class="section level3">
<h3 id="fisheries-and-structural-data">Fisheries and structural data<a class="anchor" aria-label="anchor" href="#fisheries-and-structural-data"></a>
</h3>
<p>Fisheries input data are stored in the <code>sefraData</code> object
in three data frames:</p>
<ul>
<li>observed captures:</li>
<li>observed overlap</li>
<li>commercial (total) overlap</li>
</ul>
<p>All the supplied data frames should contain the following
headers:</p>
<ul>
<li>
<code>month</code> as a character vector and/or
<code>id_month</code> as an integer value between <code>1</code> and
<code>12</code> (see <code><a href="../reference/months.html">?months</a></code>);</li>
<li>
<code>year</code> a an integer value;</li>
<li>
<code>fishery_group</code> as a character vector and/or
<code>id_fishery_group</code> as integer values.</li>
</ul>
<p>In addition, the captures data frame must include the following field
headers:</p>
<ul>
<li>
<code>code</code> as a character vector and/or <code>id_code</code>
as integer values (see <code><a href="../reference/codes.html">?codes</a></code> for permitted capture
codes);</li>
<li>
<code>n_captures</code>,</li>
<li>
<code>n_captures_alive</code> and,</li>
<li>
<code>n_captures_dead</code> as integer values.</li>
</ul>
<p>The overlap data frames should include:</p>
<ul>
<li>
<code>species</code> as a character vector and/or
<code>id_species</code> as integer values (see <code><a href="../reference/species.html">?species</a></code> for
permitted capture codes);</li>
<li>
<code>species_group</code> as a character vector and/or
<code>id_species_group</code> as integer values;</li>
<li>
<code>cell</code> and/or <code>id_cell</code> as an integer value
between <code>1</code> and <code>1224</code>, this being the number of
5x5 degree cells in the southern hemisphere. For assignment of data to
cells, please see the documentation for the <code>sefraInputs</code>
package.</li>
</ul>
<p>All months are referenced using an integer value between
<code>1</code> and <code>12</code>. This is true regardless of whether a
character vector is supplied. Similarly, all species are referenced
using an integer value between <code>1</code> and 25, and this
<code>id_species</code> value is retained throughout the assessment. The
capture code is referenced using an integer value for
<code>id_code</code> between <code>1</code> and 40, which is similarly
retained throughout the assessment and will be consistent across
different model runs or data constructs. If you wish to included
additional species or capture codes please contact the project team.</p>
<p>There are no fixed reference values for the fishery group or species
group, since these are dependent on the analysis and must be provided by
the investigator (see the vignette for <code>sefraInputs</code>).</p>
<p>Assignment functions are provided for the species group and fishery
group. These represent structural assumptions and must be supplied to
the <code>sefraData</code> object before the overlap and capture data
frames. This two-step process facilitates checking of the data.</p>
<p>To illustrate, we first create some artificial data, as three
separate data frames: <code>captures_o</code>, <code>overlap_o</code>
and <code>overlap_t</code>.</p>
<table class="table">
<caption>Header from observed captures data frame</caption>
<colgroup>
<col width="11%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="6%">
<col width="5%">
<col width="17%">
<col width="16%">
<col width="9%">
<col width="17%">
</colgroup>
<thead><tr class="header">
<th align="right">n_captures</th>
<th align="right">cell</th>
<th align="right">year</th>
<th align="left">code</th>
<th align="left">month</th>
<th align="left">flag</th>
<th align="right">n_captures_alive</th>
<th align="right">n_captures_dead</th>
<th align="right">id_month</th>
<th align="right">id_fishery_group</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">708</td>
<td align="right">2016</td>
<td align="left">DQS</td>
<td align="left">Jun</td>
<td align="left">F1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">6</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">691</td>
<td align="right">2018</td>
<td align="left">DQS</td>
<td align="left">Jun</td>
<td align="left">F1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">6</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">684</td>
<td align="right">2008</td>
<td align="left">DIW</td>
<td align="left">Mar</td>
<td align="left">F1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">687</td>
<td align="right">2007</td>
<td align="left">TWD</td>
<td align="left">Jan</td>
<td align="left">F1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">688</td>
<td align="right">2012</td>
<td align="left">DQS</td>
<td align="left">Dec</td>
<td align="left">F2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">12</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">770</td>
<td align="right">2020</td>
<td align="left">BLZ</td>
<td align="left">Aug</td>
<td align="left">F2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">8</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Header from observed overlap data frame</caption>
<colgroup>
<col width="14%">
<col width="12%">
<col width="22%">
<col width="22%">
<col width="6%">
<col width="6%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="right">id_species</th>
<th align="right">id_month</th>
<th align="right">id_fishery_group</th>
<th align="right">id_species_group</th>
<th align="right">year</th>
<th align="right">cell</th>
<th align="right">overlap</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">2</td>
<td align="right">6</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">2016</td>
<td align="right">708</td>
<td align="right">0.0004098</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">6</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">2018</td>
<td align="right">691</td>
<td align="right">0.0002191</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2008</td>
<td align="right">684</td>
<td align="right">0.0003939</td>
</tr>
<tr class="even">
<td align="right">13</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">2007</td>
<td align="right">687</td>
<td align="right">0.0005376</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">12</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">2012</td>
<td align="right">688</td>
<td align="right">0.0008761</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">8</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">2020</td>
<td align="right">770</td>
<td align="right">0.0008146</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Header from commercial (total) overlap data frame</caption>
<colgroup>
<col width="14%">
<col width="12%">
<col width="22%">
<col width="22%">
<col width="6%">
<col width="6%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="right">id_species</th>
<th align="right">id_month</th>
<th align="right">id_fishery_group</th>
<th align="right">id_species_group</th>
<th align="right">year</th>
<th align="right">cell</th>
<th align="right">overlap</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">2</td>
<td align="right">6</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">2016</td>
<td align="right">708</td>
<td align="right">0.0008923</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">6</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">2018</td>
<td align="right">691</td>
<td align="right">0.0007787</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2008</td>
<td align="right">684</td>
<td align="right">0.0002149</td>
</tr>
<tr class="even">
<td align="right">13</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">2007</td>
<td align="right">687</td>
<td align="right">0.0004784</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">12</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">2012</td>
<td align="right">688</td>
<td align="right">0.0007050</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">8</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">2020</td>
<td align="right">770</td>
<td align="right">0.0001145</td>
</tr>
</tbody>
</table>
<p>Functions are provided to assign structural assumptions based on the
input data frames. For example, we can assign fishery groups using:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fishery_groups.html">fishery_groups</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">captures_o</span></span>
<span><span class="fu"><a href="../reference/fishery_groups.html">fishery_groups</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 2 fishery groups</span></span></code></pre>
<pre><code><span><span class="co">##   fishery_group id_fishery_group</span></span>
<span><span class="co">## 1     fishery_1                1</span></span>
<span><span class="co">## 2     fishery_2                2</span></span></code></pre>
<p>This does not assign any actual data. It only extracts structural
information from the data <code>captures_o</code> data frame. Structural
assumptions can also be provided as character vectors. In this case,
care must be taken to ensure the values match the values in the
corresponding input data frames. To specify species groups for example,
we could use:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/species_groups.html">species_groups</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'group_1'</span>, <span class="st">'group_2'</span>, <span class="st">'group_3'</span><span class="op">)</span></span></code></pre></div>
<p>The same results could be achieved by assigning a data frame
directly, which is the recommended approach. In this case:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/species_groups.html">species_groups</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">overlap_o</span></span>
<span><span class="fu"><a href="../reference/species_groups.html">species_groups</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 3 species groups</span></span></code></pre>
<pre><code><span><span class="co">##   species_group id_species_group</span></span>
<span><span class="co">## 1       group_1                1</span></span>
<span><span class="co">## 2       group_2                2</span></span>
<span><span class="co">## 3       group_3                3</span></span></code></pre>
<p>When examining the species group assignments to each species, we can
use:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/species_groups.html">species_groups</a></span><span class="op">(</span><span class="va">sefra_dat</span>, print_species <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 3 species groups</span></span></code></pre>
<pre><code><span><span class="co">## (with 3 species)</span></span></code></pre>
<pre><code><span><span class="co">##   species species_group id_species id_species_group</span></span>
<span><span class="co">## 1     DIW       group_1          1                1</span></span>
<span><span class="co">## 2     DQS       group_2          2                2</span></span>
<span><span class="co">## 3     TWD       group_3         13                3</span></span></code></pre>
<p>The data frames themselves can then be assigned. In the first
instance, overlap and captures data are provided:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sefra_dat</span> <span class="op">&lt;-</span> <span class="va">sefra_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/data_prep.html">data_prep</a></span><span class="op">(</span><span class="va">overlap_o</span>, <span class="va">captures_o</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Prepared observer captures and overlap data</span></span></code></pre>
<p>In this case, two separate data frames are supplied to the
<code><a href="../reference/data_prep.html">data_prep()</a></code> function. Multiple, data frame can be provided,
as long as the referencing is consistent. It is the presence of captures
(i.e., <code>n_captures</code>) in at least one of the data frames that
identifies the data as observed. Otherwise it is treated as commercial
overlap data.</p>
<p>Following assignment of capture data, the captures per code can be
viewed using:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/capture_codes.html">capture_codes</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 10 capture codes:</span></span></code></pre>
<pre><code><span><span class="co">## Joining with `by = join_by(id_code)`</span></span></code></pre>
<pre><code><span><span class="co">##    code id_code resolution id_resolution captures</span></span>
<span><span class="co">## 1   DIW       1    species             1       27</span></span>
<span><span class="co">## 2   DQS       2    species             1       26</span></span>
<span><span class="co">## 3   TWD      13    species             1       23</span></span>
<span><span class="co">## 4   DGA      26    complex             2        0</span></span>
<span><span class="co">## 5   DST      29    complex             2        0</span></span>
<span><span class="co">## 6   DWC      32    complex             2        0</span></span>
<span><span class="co">## 7   DIZ      34      genus             3       21</span></span>
<span><span class="co">## 8   THZ      35      genus             3       10</span></span>
<span><span class="co">## 9   ALZ      38     family             4        0</span></span>
<span><span class="co">## 10  BLZ      40      class             5       21</span></span></code></pre>
<p>or by taxonomic resolution using:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/capture_resolutions.html">capture_resolutions</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 10 capture code resolutions:</span></span></code></pre>
<pre><code><span><span class="co">## Joining with `by = join_by(id_fishery_group, id_code)`</span></span></code></pre>
<pre><code><span><span class="co">##    id_fishery_group id_resolution resolution captures</span></span>
<span><span class="co">## 1                 1             1    complex        0</span></span>
<span><span class="co">## 2                 1             1    species       12</span></span>
<span><span class="co">## 3                 1             2      genus       10</span></span>
<span><span class="co">## 4                 1             2    species       13</span></span>
<span><span class="co">## 5                 1             3      genus        3</span></span>
<span><span class="co">## 6                 1             3    species       11</span></span>
<span><span class="co">## 7                 1             4    complex        0</span></span>
<span><span class="co">## 8                 1             4     family        0</span></span>
<span><span class="co">## 9                 1             5      class       13</span></span>
<span><span class="co">## 10                1             5    complex        0</span></span>
<span><span class="co">## 11                2             1    complex        0</span></span>
<span><span class="co">## 12                2             1    species       15</span></span>
<span><span class="co">## 13                2             2      genus       11</span></span>
<span><span class="co">## 14                2             2    species       13</span></span>
<span><span class="co">## 15                2             3      genus        7</span></span>
<span><span class="co">## 16                2             3    species       12</span></span>
<span><span class="co">## 17                2             4    complex        0</span></span>
<span><span class="co">## 18                2             4     family        0</span></span>
<span><span class="co">## 19                2             5      class        8</span></span>
<span><span class="co">## 20                2             5    complex        0</span></span></code></pre>
<p>In the latter case, captures are disaggregated by fishery group.</p>
<p>To assign the commercial overlap data use:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sefra_dat</span> <span class="op">&lt;-</span> <span class="va">sefra_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/data_prep.html">data_prep</a></span><span class="op">(</span><span class="va">overlap_t</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Prepared commercial (total) overlap data</span></span></code></pre>
<p>To check the data have loaded correctly we can view the object:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sefra_dat</span></span></code></pre></div>
<pre><code><span><span class="co">## 'sefraData' class object:</span></span></code></pre>
<pre><code><span><span class="co">## Species</span></span></code></pre>
<pre><code><span><span class="co">##    code                        common_name                    scientific_name</span></span>
<span><span class="co">## 1   DIW                 Gibson's albatross      Diomedea antipodensis gibsoni</span></span>
<span><span class="co">## 2   DQS               Antipodean albatross Diomedea antipodensis antipodensis</span></span>
<span><span class="co">## 13  TWD New Zealand white-capped albatross          Thalassarche cauta steadi</span></span>
<span><span class="co">##           genus      family code_resolution id_species</span></span>
<span><span class="co">## 1      Diomedea Diomedeidae         species          1</span></span>
<span><span class="co">## 2      Diomedea Diomedeidae         species          2</span></span>
<span><span class="co">## 13 Thalassarche Diomedeidae         species         13</span></span></code></pre>
<pre><code><span><span class="co">## 3 species groups</span></span></code></pre>
<pre><code><span><span class="co">## (with 3 species)</span></span></code></pre>
<pre><code><span><span class="co">##   species species_group id_species id_species_group</span></span>
<span><span class="co">## 1     DIW       group_1          1                1</span></span>
<span><span class="co">## 2     DQS       group_2          2                2</span></span>
<span><span class="co">## 3     TWD       group_3         13                3</span></span></code></pre>
<pre><code><span><span class="co">## 2 fishery groups</span></span></code></pre>
<pre><code><span><span class="co">##   fishery_group id_fishery_group</span></span>
<span><span class="co">## 1     fishery_1                1</span></span>
<span><span class="co">## 2     fishery_2                2</span></span></code></pre>
<pre><code><span><span class="co">## 10 capture codes:</span></span></code></pre>
<pre><code><span><span class="co">## Joining with `by = join_by(id_code)`</span></span></code></pre>
<pre><code><span><span class="co">##    code id_code resolution id_resolution captures</span></span>
<span><span class="co">## 1   DIW       1    species             1       27</span></span>
<span><span class="co">## 2   DQS       2    species             1       26</span></span>
<span><span class="co">## 3   TWD      13    species             1       23</span></span>
<span><span class="co">## 4   DGA      26    complex             2        0</span></span>
<span><span class="co">## 5   DST      29    complex             2        0</span></span>
<span><span class="co">## 6   DWC      32    complex             2        0</span></span>
<span><span class="co">## 7   DIZ      34      genus             3       21</span></span>
<span><span class="co">## 8   THZ      35      genus             3       10</span></span>
<span><span class="co">## 9   ALZ      38     family             4        0</span></span>
<span><span class="co">## 10  BLZ      40      class             5       21</span></span></code></pre>
<pre><code><span><span class="co">## Captures data frame:</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 78 × 6</span></span></span>
<span><span class="co">##    captures_k captures_live_k captures_dead_k code_k month_k fishery_group_k</span></span>
<span><span class="co">##         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>          1               1               0      1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>          1               1               0      1       2               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>          2               1               1      1       3               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>          1               1               0      1       5               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>          2               1               1      1       6               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>          1               1               0      1       7               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>          1               1               0      1      10               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>          1               0               1      1      11               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>          2               1               1      1      12               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>          3               2               1      1       1               2</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 68 more rows</span></span></span></code></pre>
<pre><code><span><span class="co">## Observed overlap data frame:</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 72 × 5</span></span></span>
<span><span class="co">##    overlap_i species_i species_group_i month_i fishery_group_i</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>   0.007<span style="text-decoration: underline;">76</span>         1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>   0.001<span style="text-decoration: underline;">39</span>         1               1       2               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>   0.005<span style="text-decoration: underline;">68</span>         1               1       3               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>   0.008<span style="text-decoration: underline;">31</span>         1               1       4               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>   0.005<span style="text-decoration: underline;">41</span>         1               1       5               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>   0.006<span style="text-decoration: underline;">97</span>         1               1       6               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>   0.009<span style="text-decoration: underline;">56</span>         1               1       7               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>   0.007<span style="text-decoration: underline;">70</span>         1               1       8               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>   0.007<span style="text-decoration: underline;">40</span>         1               1       9               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>   0.004<span style="text-decoration: underline;">86</span>         1               1      10               1</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 62 more rows</span></span></span></code></pre>
<pre><code><span><span class="co">## Commercial overlap data frame:</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 962 × 5</span></span></span>
<span><span class="co">##    overlap_j species_j species_group_j month_j fishery_group_j</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 0.000<span style="text-decoration: underline;">384</span>          1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 0.000<span style="text-decoration: underline;">196</span>          1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 0.000<span style="text-decoration: underline;">258</span>          1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 0.000<span style="text-decoration: underline;">064</span>4         1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 0.000<span style="text-decoration: underline;">763</span>          1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 0.000<span style="text-decoration: underline;">477</span>          1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 0.000<span style="text-decoration: underline;">584</span>          1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 0.000<span style="text-decoration: underline;">653</span>          1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 0.000<span style="text-decoration: underline;">618</span>          1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 0.000<span style="text-decoration: underline;">430</span>          1               1       1               1</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 952 more rows</span></span></span></code></pre>
<p>Captures and overlap data can also be extracted using,
respectively:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/captures.html">captures</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 78 × 6</span></span></span>
<span><span class="co">##    captures_k captures_live_k captures_dead_k code_k month_k fishery_group_k</span></span>
<span><span class="co">##         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>          1               1               0      1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>          1               1               0      1       2               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>          2               1               1      1       3               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>          1               1               0      1       5               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>          2               1               1      1       6               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>          1               1               0      1       7               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>          1               1               0      1      10               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>          1               0               1      1      11               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>          2               1               1      1      12               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>          3               2               1      1       1               2</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 68 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/overlap.html">overlap</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $observer</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 72 × 5</span></span></span>
<span><span class="co">##    overlap_i species_i species_group_i month_i fishery_group_i</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>   0.007<span style="text-decoration: underline;">76</span>         1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>   0.001<span style="text-decoration: underline;">39</span>         1               1       2               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>   0.005<span style="text-decoration: underline;">68</span>         1               1       3               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>   0.008<span style="text-decoration: underline;">31</span>         1               1       4               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>   0.005<span style="text-decoration: underline;">41</span>         1               1       5               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>   0.006<span style="text-decoration: underline;">97</span>         1               1       6               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>   0.009<span style="text-decoration: underline;">56</span>         1               1       7               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>   0.007<span style="text-decoration: underline;">70</span>         1               1       8               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>   0.007<span style="text-decoration: underline;">40</span>         1               1       9               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>   0.004<span style="text-decoration: underline;">86</span>         1               1      10               1</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 62 more rows</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $fishery</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 962 × 5</span></span></span>
<span><span class="co">##    overlap_j species_j species_group_j month_j fishery_group_j</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 0.000<span style="text-decoration: underline;">384</span>          1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 0.000<span style="text-decoration: underline;">196</span>          1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 0.000<span style="text-decoration: underline;">258</span>          1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 0.000<span style="text-decoration: underline;">064</span>4         1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 0.000<span style="text-decoration: underline;">763</span>          1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 0.000<span style="text-decoration: underline;">477</span>          1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 0.000<span style="text-decoration: underline;">584</span>          1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 0.000<span style="text-decoration: underline;">653</span>          1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 0.000<span style="text-decoration: underline;">618</span>          1               1       1               1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 0.000<span style="text-decoration: underline;">430</span>          1               1       1               1</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 952 more rows</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="cryptic-capture">Cryptic capture<a class="anchor" aria-label="anchor" href="#cryptic-capture"></a>
</h3>
<p>Cryptic capture distribution parameters are defined by species group
and fishery group, and can be assigned as follows:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cryptic_capture.html">cryptic_capture</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span>  <span class="op">&lt;-</span> <span class="va">cryptic_capture_longline</span></span></code></pre></div>
<pre><code><span><span class="co">## 2 fishery groups</span></span></code></pre>
<pre><code><span><span class="co">## 3 species groups</span></span></code></pre>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cryptic_capture.html">cryptic_capture</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    distribution fishery_group species_group  par value</span></span>
<span><span class="co">## 1    log-normal     fishery_1       group_1 par1 1.420</span></span>
<span><span class="co">## 2    log-normal     fishery_2       group_1 par1 1.420</span></span>
<span><span class="co">## 3    log-normal     fishery_1       group_2 par1 1.420</span></span>
<span><span class="co">## 4    log-normal     fishery_2       group_2 par1 1.420</span></span>
<span><span class="co">## 5    log-normal     fishery_1       group_3 par1 1.420</span></span>
<span><span class="co">## 6    log-normal     fishery_2       group_3 par1 1.420</span></span>
<span><span class="co">## 7    log-normal     fishery_1       group_1 par2 0.186</span></span>
<span><span class="co">## 8    log-normal     fishery_2       group_1 par2 0.186</span></span>
<span><span class="co">## 9    log-normal     fishery_1       group_2 par2 0.186</span></span>
<span><span class="co">## 10   log-normal     fishery_2       group_2 par2 0.186</span></span>
<span><span class="co">## 11   log-normal     fishery_1       group_3 par2 0.186</span></span>
<span><span class="co">## 12   log-normal     fishery_2       group_3 par2 0.186</span></span></code></pre>
<p>At present, only a <code>log-normal</code> distribution is allowed.
Values stored in the the <code>cryptic_capture_longline</code> object
represent the authors best understanding of cryptic capture in longline
fisheries, but can be adjusted as required by the user. We have
stratified the cryptic captures assumption by species group, because we
are currently not aware of any information that would allow a higher
resolution.</p>
</div>
</div>
<div class="section level2">
<h2 id="example-model-run">Example model run<a class="anchor" aria-label="anchor" href="#example-model-run"></a>
</h2>
<p>First, source and compile the model code:</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sefra_mdl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sefraModel-class.html">sefraModel</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## SEFRA-seabird model v3.0.1</span></span></code></pre>
<p>The <code><a href="../reference/sefraModel-class.html">sefraModel()</a></code> function can optionally be supplied
with the <code>sefraData-class</code> object as an argument. If
commercial overlap is missing from the data, then predicted captures,
deaths and risk are not calculated by the model. Only catchabilities and
fits to the observed captures will be generated. This will lower the
memory requirements for the model and may be useful for initial
model-based explorations of the data.</p>
<p>Note that a custom model can also be provided to
<code><a href="../reference/sefraModel-class.html">sefraModel()</a></code>. In this instance we recommend first calling
<code>sefraModel(write_to = &lt;file&gt;)</code> to write the
<code>stan</code> code as a text file. This base code can then be
modified by the user and re-compiled using
<code>sefraModel(read_from = &lt;file&gt;)</code>.</p>
<p>The <code>sefraModel-class</code> object will contain the initial
values. These can be updated using <code><a href="../reference/initial_values.html">initial_values()</a></code> to
generate a maximum posterior density estimate. To check initial
values:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sefra_mdl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initial_values.html">initial_values</a></span><span class="op">(</span><span class="va">sefra_dat</span>, <span class="va">sefra_mdl</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## initial model fit <span style="color: #00BB00;">✔</span></span></span></code></pre>
<p><img src="run_model_files/figure-html/unnamed-chunk-25-1.png" alt="" width="672"></p>
<p>This can be useful for quickly exploring the structural assumptions
of the model, and whether reasonable fits to the data are obtained.
Typically, structural mis-specification of the species and fishery
groups, or a deficiency in the data, will lead to stronger prior updates
on the biological parameters.</p>
<p>When fitting, the model attempts to reconstruct the number of
captures by estimating the catchabilities and observation probabilities
according to the structural assumptions implemented by the user. In
addition to estimating direct fits to the data, the model also
calculates the cumulative sum of the captures, which can be used to
examine whether the total number of captures per taxonomic group is
being accurately predicted. In particular, we would hope that the total
number of captures across all taxonomic groups is accuratly predicted by
the model, which can be determined from the models ability to predict
the cumulative sum of <code>BLZ</code> captures.</p>
<p>To calculate the cumulative sum of the capture data, captures are
summed per fishery group and capture code. Following summation, capture
codes represent all captures at that taxonomic resolution or higher. For
example, using the current data, the captures per capture code and
fishery group are represented within the model as a two-dimensional
matrix, with the fishery groups along the first dimension:</p>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'id_fishery_group'. You can override using</span></span>
<span><span class="co">## the `.groups` argument.</span></span>
<span><span class="co">## Joining with `by = join_by(id_fishery_group, code)`</span></span></code></pre>
<pre><code><span><span class="co">##           DIW DQS TWD DGA DST DWC DIZ THZ ALZ BLZ</span></span>
<span><span class="co">## fishery_1  12  13  11   0   0   0  10   3   0  13</span></span>
<span><span class="co">## fishery_2  15  13  12   0   0   0  11   7   0   8</span></span></code></pre>
<p>The cumulative sum (or “inclusive sum”) of the capture codes used for
fitting the model are:</p>
<pre><code><span><span class="co">##           DIW DQS TWD DGA DST DWC DIZ THZ ALZ BLZ</span></span>
<span><span class="co">## fishery_1  12  13  11  25  11  25  35  14  49  62</span></span>
<span><span class="co">## fishery_2  15  13  12  28  12  28  39  19  58  66</span></span></code></pre>
<p>For the <code>BLZ</code> capture code, there are 21 captures recorded
as <code>BLZ</code> in the empirical data, but a total of 128
<code>BLZ</code> captures when summed across captures recorded as
<code>BLZ</code> or a higher taxonomic resolution. We refer to 21 as the
<code>empirical</code> captures and 128 as the <code>inclusive</code>
captures. Similarly for <code>DIZ</code> we have 21
<code>empirical</code> captures and 74 <code>inclusive</code> captures.
This definition of <code>inclusive</code> captures is relevant to the
model fit and downstream diagnostics.</p>
<div class="section level3">
<h3 id="model-run">Model run<a class="anchor" aria-label="anchor" href="#model-run"></a>
</h3>
<p>Sample from the posterior using the <code>$sampling()</code> function
from <code>cmdstanr</code>:</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sefra_mdl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sampler.html">sampler</a></span><span class="op">(</span><span class="va">sefra_dat</span>, <span class="va">sefra_mdl</span>, chains <span class="op">=</span> <span class="fl">2</span>, parallel_chains <span class="op">=</span> <span class="fl">2</span>, iter_warmup <span class="op">=</span> <span class="fl">1000</span>, iter_sampling <span class="op">=</span> <span class="fl">1000</span>, threads_per_chain <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>The different scales on which biological parameters are estimated can
make it difficult for the MCMC chain to explore the full parameter
space, and the user may therefore wish to adjust the
<code>adapt_delta</code>, <code>stepsize</code> or
<code>max_treedepth</code> control parameters. We further recommend that
<code>uniform</code> priors should only be used for
<code>p_breeding</code> and <code>adult_survival</code> (if at all) and
not for <code>n_breeding_pairs</code> or <code>age_breeding</code>.</p>
<p>Functions exist to extract and summarise relevant model outputs, to
allow the user to create their own diagnostic plots and tables:</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sefra_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sefraOutputs-class.html">sefraOutputs</a></span><span class="op">(</span><span class="va">sefra_dat</span>, <span class="va">sefra_mdl</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## constructed 'sefraOutputs' object <span style="color: #00BB00;">✔</span></span></span></code></pre>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sefra_out</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>PST</caption>
<thead><tr class="header">
<th align="left">species</th>
<th align="right">mean</th>
<th align="right">mq</th>
<th align="right">lq</th>
<th align="right">uq</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">DIW</td>
<td align="right">306.7724</td>
<td align="right">303.7025</td>
<td align="right">229.7858</td>
<td align="right">403.6591</td>
</tr>
<tr class="even">
<td align="left">DQS</td>
<td align="right">285.8586</td>
<td align="right">280.6301</td>
<td align="right">207.6187</td>
<td align="right">390.3796</td>
</tr>
<tr class="odd">
<td align="left">TWD</td>
<td align="right">6662.0626</td>
<td align="right">6533.0709</td>
<td align="right">4318.3926</td>
<td align="right">9876.8959</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Risk ratio</caption>
<thead><tr class="header">
<th align="left">species</th>
<th align="right">mean</th>
<th align="right">mq</th>
<th align="right">lq</th>
<th align="right">uq</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">DIW</td>
<td align="right">0.0089556</td>
<td align="right">0.0087423</td>
<td align="right">0.0054751</td>
<td align="right">0.0140560</td>
</tr>
<tr class="even">
<td align="left">DQS</td>
<td align="right">0.0105234</td>
<td align="right">0.0101956</td>
<td align="right">0.0058968</td>
<td align="right">0.0173810</td>
</tr>
<tr class="odd">
<td align="left">TWD</td>
<td align="right">0.0004815</td>
<td align="right">0.0004625</td>
<td align="right">0.0002683</td>
<td align="right">0.0008196</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="model-diagnostics">Model diagnostics<a class="anchor" aria-label="anchor" href="#model-diagnostics"></a>
</h3>
<p>Trace plots can be used to visualise convergence. For example, we can
plot trace diagnostics for the biological parameters using, for
example:</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trace_plot.html">trace_plot</a></span><span class="op">(</span><span class="va">sefra_mdl</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p_breeding"</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"P["</span>, <span class="va">sefra_dat</span><span class="op">$</span><span class="va">species</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="run_model_files/figure-html/unnamed-chunk-32-1.png" alt="" width="672"></p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#trace_plot(mdl_fit, pars = c("age_breeding"), labels = list(species = paste0("alpha[", sefra_dat$species, "]")))</span></span>
<span><span class="co">#trace_plot(mdl_fit, pars = c("adult_survival"), labels = list(species = paste0("S[", sefra_dat$species, "]")))</span></span>
<span><span class="co">#trace_plot(mdl_fit, pars = c("n_breeding_pairs"), labels = list(species = paste0("N[", sefra_dat$species, "]")))</span></span></code></pre></div>
<p>the probabilities of observation:</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trace_plot.html">trace_plot</a></span><span class="op">(</span><span class="va">sefra_mdl</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p_obs_logit"</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fishery_group <span class="op">=</span> <span class="va">sefra_dat</span><span class="op">$</span><span class="va">fishery_groups</span>, pi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"pi["</span>, <span class="fl">1</span><span class="op">:</span><span class="va">sefra_dat</span><span class="op">$</span><span class="va">n_pi</span>, <span class="st">"]"</span><span class="op">)</span>, resolution <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">$</span><span class="va">resolutions</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="run_model_files/figure-html/unnamed-chunk-33-1.png" alt="" width="672"></p>
<p>or the catchabilities:</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trace_plot.html">trace_plot</a></span><span class="op">(</span><span class="va">sefra_mdl</span>, pars <span class="op">=</span> <span class="st">"q"</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fishery_group <span class="op">=</span> <span class="va">sefra_dat</span><span class="op">$</span><span class="va">fishery_groups</span>, species_group <span class="op">=</span> <span class="va">sefra_dat</span><span class="op">$</span><span class="va">species_groups</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="run_model_files/figure-html/unnamed-chunk-34-1.png" alt="" width="672"></p>
<p>To visualise prior updates to the biological input distributions, we
use, for example:</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_prior_update.html">plot_prior_update</a></span><span class="op">(</span><span class="va">sefra_mdl</span>, par <span class="op">=</span> <span class="st">"n_breeding_pairs"</span>, species_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">sefra_dat</span><span class="op">$</span><span class="va">species</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="run_model_files/figure-html/unnamed-chunk-35-1.png" alt="" width="480"></p>
<p>Only one biological parameter can be included per box-plot.</p>
<p>Diagnostic plots also exist for Rhat and Neff. For example:</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">[</span><span class="st">","</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">alpha</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">[</span><span class="st">","</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">alpha</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">[</span><span class="st">","</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">alpha</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">[</span><span class="st">","</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">alpha</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">[</span><span class="st">","</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">alpha</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">[</span><span class="st">","</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/get_rhat.html">plot_rhat</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_traces.html">get_traces</a></span><span class="op">(</span><span class="va">sefra_mdl</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha_species_group"</span><span class="op">)</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fishery_group <span class="op">=</span> <span class="va">sefra_dat</span><span class="op">$</span><span class="va">fishery_groups</span>, species_group <span class="op">=</span> <span class="va">sefra_dat</span><span class="op">$</span><span class="va">species_groups</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, labels <span class="op">=</span> <span class="va">par_labels</span><span class="op">)</span></span></code></pre></div>
<p><img src="run_model_files/figure-html/unnamed-chunk-36-1.png" alt="" width="480"></p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_rhat.html">plot_neff</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_traces.html">get_traces</a></span><span class="op">(</span><span class="va">sefra_mdl</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha_species_group"</span><span class="op">)</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fishery_group <span class="op">=</span> <span class="va">sefra_dat</span><span class="op">$</span><span class="va">fishery_groups</span>, species_group <span class="op">=</span> <span class="va">sefra_dat</span><span class="op">$</span><span class="va">species_groups</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, labels <span class="op">=</span> <span class="va">par_labels</span><span class="op">)</span></span></code></pre></div>
<p><img src="run_model_files/figure-html/unnamed-chunk-36-2.png" alt="" width="480"></p>
<p>Perhaps the most useful diagnostic is provided from examination of
fits to the capture data, and a specific function exists for this
purpose:</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/captures.html">captures</a></span><span class="op">(</span><span class="va">sefra_dat</span>, <span class="va">sefra_mdl</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $captures</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 20 × 7</span></span></span>
<span><span class="co">##    fishery_group code  captures hat_mean hat_mq hat_lq hat_uq</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> fishery_1     DIW         12     8.46      8      2   17  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> fishery_1     DQS         13     9.03      9      3   18  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> fishery_1     TWD         11     6.85      6      1   14  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> fishery_1     DGA          0     1.44      1      0    5  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> fishery_1     DST          0     1.97      2      0    6  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> fishery_1     DWC          0     1.45      1      0    5  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> fishery_1     DIZ         10    10.5      10      3   20  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> fishery_1     THZ          3     3.92      4      0   10  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> fishery_1     ALZ          0     4.52      4      0   11  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> fishery_1     BLZ         13    13.8      13      5   25  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span> fishery_2     DIW         15    10.3      10      3   20  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">12</span> fishery_2     DQS         13     8.93      9      2   18  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">13</span> fishery_2     TWD         12     8.19      8      2   16  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">14</span> fishery_2     DGA          0     1.46      1      0    5  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">15</span> fishery_2     DST          0     2.19      2      0    7  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">16</span> fishery_2     DWC          0     1.48      1      0    5  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">17</span> fishery_2     DIZ         11    11.4      11      4   21  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">18</span> fishery_2     THZ          7     6.51      6      1   14  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">19</span> fishery_2     ALZ          0     4.66      4      0   11.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">20</span> fishery_2     BLZ          8    10.7      10      4   20  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $captures_inclusive</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 20 × 7</span></span></span>
<span><span class="co">##    fishery_group code  captures hat_mean hat_mq hat_lq hat_uq</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> fishery_1     DIW         12     8.48      8      2   17  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> fishery_1     DQS         13     9.01      9      2   18.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> fishery_1     TWD         11     6.74      6      1   14  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> fishery_1     DGA         25    18.9      18      9   32  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> fishery_1     DST         11     8.79      8      2   18  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> fishery_1     DWC         25    20.2      20     10   33  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> fishery_1     DIZ         35    30.8      30     17   48  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> fishery_1     THZ         14    12.7      12      5   23  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> fishery_1     ALZ         49    48.1      48     30   69  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> fishery_1     BLZ         62    62.1      62     41   87  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span> fishery_2     DIW         15    10.3      10      3   20  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">12</span> fishery_2     DQS         13     8.89      8      3   18  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">13</span> fishery_2     TWD         12     8.19      8      2   17  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">14</span> fishery_2     DGA         28    20.8      20     10   35  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">15</span> fishery_2     DST         12    10.4      10      4   19.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">16</span> fishery_2     DWC         28    22.1      21     11   36  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">17</span> fishery_2     DIZ         39    33.5      33     20   51  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">18</span> fishery_2     THZ         19    16.9      16      7   29  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">19</span> fishery_2     ALZ         58    54.9      54     37   76  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">20</span> fishery_2     BLZ         66    65.8      65     45   89</span></span></code></pre>
<p>Further diagnostic are provided in an accompanying vignette.</p>
<p>To reconstruct maps, we can use values stored in the
<code>sefraOutputs</code> object.</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># reconstruct maps</span></span>
<span></span>
<span><span class="va">map_deaths</span> <span class="op">&lt;-</span> <span class="va">sefra_out</span><span class="op">$</span><span class="va">predicted_deaths</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">iter</span>, <span class="va">species</span>, <span class="va">cell</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">cell</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'iter', 'species'. You can override using</span></span>
<span><span class="co">## the `.groups` argument.</span></span>
<span><span class="co">## `summarise()` has grouped output by 'species'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_deaths</span> <span class="op">&lt;-</span> <span class="fu">sefraInputs</span><span class="fu">::</span><span class="va">grid</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">map_deaths</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id_cell"</span> <span class="op">=</span> <span class="st">"cell"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">map_deaths</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">sefraInputs</span><span class="fu">::</span><span class="va">grid</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">sefraInputs</span><span class="fu">::</span><span class="va">southern_map</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, col <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">species</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="run_model_files/figure-html/unnamed-chunk-38-1.png" alt="" width="672"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Charles Edwards, Tom Peatman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
