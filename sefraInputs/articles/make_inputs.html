<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Create SEFRA inputs • sefraInputs</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create SEFRA inputs">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sefraInputs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/make_inputs.html">Create SEFRA inputs</a></li>
    <li><a class="dropdown-item" href="../articles/test_sefra_data.html">Check SEFRA data inputs</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sefra-seabirds/sefraInputs/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create SEFRA inputs</h1>
                        <h4 data-toc-skip class="author">Tom Peatman and
Charles Edwards</h4>
            
            <h4 data-toc-skip class="date">10-Feb-2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sefra-seabirds/sefraInputs/blob/HEAD/vignettes/make_inputs.Rmd" class="external-link"><code>vignettes/make_inputs.Rmd</code></a></small>
      <div class="d-none name"><code>make_inputs.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette provides an example of the preparation of observed
captures and effort for incorporation in the 2025 CCSBT collaborative
seabird risk assessment, applied to a simple synthetic dataset. The
overall approach is identical to that used for the 2024 CCSBT seabird
risk assessment, apart from the process of loading in biological data
inputs. This has been updated to allow members to prepare their observed
captures and effort datasets using different sets of biological inputs,
e.g., different seabird density layers.</p>
</div>
<div class="section level2">
<h2 id="set-up-an-r-session-for-data-preparation">Set up an <code>R</code> session for data preparation<a class="anchor" aria-label="anchor" href="#set-up-an-r-session-for-data-preparation"></a>
</h2>
<p>Load packages required for data preparation and visualisation:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sefra-seabirds/sefraInputs" class="external-link">sefraInputs</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html" class="external-link">sf_use_s2</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>dplyr.summarise.inform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Create a local directory in which to save the groomed data necessary
for analysis. For the current demonstration, we use the temporary folder
generated as part of the active R session:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dir_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
<p>The <code>dir_data</code> directory should not have any groomed data
or outputs from previous data preparation attempts, to avoid issues with
version control. The following will remove all ‘R’ data (i.e. files with
.rda or .RData extensions) and TeX (.tex extensions) files in the
<code>dir_data</code> folder and any sub-folders:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/make_folder.html">make_folder</a></span><span class="op">(</span><span class="va">dir_data</span>, clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## directory created</span></span></code></pre>
<p>Here, we define characters that should not be used in User defined
names, e.g. for species groups, fishery groups, time periods, etc.:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">latex_special_characters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"\\$"</span>, <span class="st">"\\&amp;"</span>, <span class="st">"\\_"</span>, <span class="st">"\\{"</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span></span>
<span><span class="va">punctuation_characters</span> <span class="op">&lt;-</span> <span class="st">"[[:punct:]]"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="minimum-data-requirements">Minimum data requirements<a class="anchor" aria-label="anchor" href="#minimum-data-requirements"></a>
</h2>
<p>Raw observed effort and seabird captures data from pelagic longliners
should be stored and accessed using custom scripts developed by the
User. We recommend that observed effort and observed seabird captures
are sourced separately, and we will assume this to be the case.</p>
<p>The minimum requirements for these data are described here, with
required column headers:</p>
<ul>
<li><p>Both the observed effort and captures data must include variables
for: <code>flag</code> (ISO 3166-1 alpha-3 country code),
<code>year</code>, <code>month</code>, latitude (<code>lat</code>) and
longitude (<code>lon</code>). Additional covariates will be required if
they are needed to define <code>fishery_group</code> for the purposes of
estimating catchabilities. Typically, <code>fishery_group</code> will be
defined by the <code>flag</code>, but it is possible to define the
fishery group using other covariates, e.g. target species.</p></li>
<li><p>Observed effort should be provided with units of thousand hooks
(<code>observer_effort</code>). Observer effort can be summed per
<code>flag</code>, <code>year</code>, <code>month</code>,
<code>lat</code>, <code>lon</code> and <code>fishery_group</code> to
reduce file size.</p></li>
<li><p>Observed captures should be provided with variables for species
code (<code>code</code>), status at-vessel (<code>status</code> =
<code>alive</code>, <code>dead</code> or <code>NA</code> for unknown),
and number of individuals captured (<code>n_captures</code>).
Information on age-class of captures should also be provided where
available (<code>age_class</code> = <code>adult</code>,
<code>immature</code>, <code>juvenile</code>, <code>NA</code>). Although
this information is not currently incorporated in the risk assessment
model, inclusion of data on the age-class of captures will allow the
preparation of high-level summaries of captures by age-class.</p></li>
<li><p>The <code>lat</code> and <code>lon</code> covariates must
correspond to the centre of a 5x5 degree spatial grid or finer, to be
compatible with the seabird density maps. See the ‘Spatial grid
definition’ section for more information on the spatial structure of
observer data. The observer data can be provided by the User at any
spatial resolution, so long as each record can be attributed to a single
cell in (see <code><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">?grid</a></code>). Because the population density maps
are at a 5x5 degree resolution, and the data are summed across space to
create a measure of overlap, there is no advantage to preparing the data
at a finer resolution.</p></li>
<li><p>The temporal resolution of the observer data must be (at a
minimum) by <code>year</code> and <code>month</code>, to be compatible
with the seabird density maps.</p></li>
<li><p>To ensure that catchabilities are correctly estimated, the catch
and effort data must be correctly matched. This means that the capture
data must be from strata represented in the observer effort data, and
that matching columns contain equivalent information in an equivalent
format. As part of the data grooming process, observed captures are
linked to the corresponding observed effort, and an identical
stratification of the data is therefore necessary. If there are captures
outside of the spatial or temporal range of the observer effort data,
these captures should be removed until the source of the error is
identified. This forms a part of data preparation scripts
below.</p></li>
</ul>
<div class="section level3">
<h3 id="check-observer-data-meet-minimum-requirements">Check observer data meet minimum requirements<a class="anchor" aria-label="anchor" href="#check-observer-data-meet-minimum-requirements"></a>
</h3>
<p>Get totals for initial observed effort and captures. These allow the
effects of data filtering to be reported:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N_EFFORT</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obs_effort</span><span class="op">$</span><span class="va">observer_effort</span><span class="op">)</span></span>
<span><span class="va">N_CAPTURES</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obs_captures</span><span class="op">$</span><span class="va">n_captures</span><span class="op">)</span></span></code></pre></div>
<p>Functions <code>check_obs_effort</code> and
<code>check_obs_captures</code> should be used to ensure that the
observer data meet the minimum requirements:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_observed_effort.html">check_observed_effort</a></span><span class="op">(</span><span class="va">obs_effort</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/check_observed_captures.html">check_observed_captures</a></span><span class="op">(</span><span class="va">obs_captures</span><span class="op">)</span></span></code></pre></div>
<p>Additionally, the User may also assign
<code>check_observed_effort</code> and
<code>check_observed_captures</code> to filter out <code>NA</code>s in
the appropriate variables:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_effort</span>   <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_observed_effort.html">check_observed_effort</a></span><span class="op">(</span><span class="va">obs_effort</span><span class="op">)</span></span>
<span><span class="va">obs_captures</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_observed_captures.html">check_observed_captures</a></span><span class="op">(</span><span class="va">obs_captures</span><span class="op">)</span></span></code></pre></div>
<p>The stratification of <code>obs_effort</code> and
<code>obs_captures</code> should be identical, and there should not be
strata with observed captures but no observed effort.</p>
<p>Get the variables that define the stratification of the observer data
(<code>strata_vars</code>), and ensure that they are present in both the
observer effort and capture data:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Variables that define stratification of observed effort data</span></span>
<span><span class="va">strata_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">obs_effort</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">obs_effort</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"observer_effort"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">strata_vars</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">obs_effort</span><span class="op">)</span>, <span class="va">strata_vars</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">obs_captures</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Check that each record in <code>obs_captures</code> matches at most
one record in <code>obs_effort</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_effort</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">obs_captures</span>, by <span class="op">=</span> <span class="va">strata_vars</span>, relationship <span class="op">=</span> <span class="st">"one-to-many"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre></div>
<p>This will return an error if a record in <code>obs_captures</code>
matches multiple records in <code>obs_effort</code> (due to the
<code>relationship</code> argument).</p>
<p>There should not be multiple records in the observer effort data for
a particular strata, as this would introduce duplication in captures
data when they are joined:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># effort records per strata</span></span>
<span><span class="va">effort_records_per_strata</span> <span class="op">&lt;-</span> <span class="va">obs_effort</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by_all.html" class="external-link">group_by_at</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">strata_vars</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.</span>, n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">effort_records_per_strata</span><span class="op">$</span><span class="va">n</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Filter out captures for strata with no corresponding observed effort
data:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_captures</span> <span class="op">&lt;-</span> <span class="va">obs_captures</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">semi_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">obs_effort</span>, by <span class="op">=</span> <span class="va">strata_vars</span><span class="op">)</span></span></code></pre></div>
<p>Summarise remaining observed effort and captures after initial
filtering:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Retained effort accounts for "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obs_effort</span><span class="op">$</span><span class="va">observer_effort</span><span class="op">)</span><span class="op">/</span><span class="va">N_EFFORT</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"% of total observed effort provided by User"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Retained captures account for "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obs_captures</span><span class="op">$</span><span class="va">n_captures</span><span class="op">)</span><span class="op">/</span><span class="va">N_CAPTURES</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"% of total observed captures provided by User"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="synthetic-datasets-used-in-this-vignette">Synthetic datasets used in this vignette<a class="anchor" aria-label="anchor" href="#synthetic-datasets-used-in-this-vignette"></a>
</h2>
<p>In this vignette, we demonstrate how data can be prepared and saved
to the directory <code>dir_data</code> on the User’s machine, using the
synthetic data provided with this package build. The synthetic data
consists of two files:</p>
<ul>
<li><p>Observed effort data in <code>obs_effort</code>.</p></li>
<li><p>Observed seabird captures in <code>obs_captures</code>.</p></li>
</ul>
<p>These are loaded into the current <code>R</code> session, for
demonstration of the code:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">obs_effort</span>, <span class="va">obs_captures</span><span class="op">)</span></span></code></pre></div>
<p>The synthetic observed effort and captures data have the following
structure:</p>
<table class="table">
<caption>Headers for observed effort (synthetic data)</caption>
<thead><tr class="header">
<th align="left">flag</th>
<th align="left">target</th>
<th align="right">year</th>
<th align="right">month</th>
<th align="right">lon</th>
<th align="right">lat</th>
<th align="right">observer_effort</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">BET+YFT</td>
<td align="right">2020</td>
<td align="right">1</td>
<td align="right">72.5</td>
<td align="right">-32.5</td>
<td align="right">100</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">ALB</td>
<td align="right">2020</td>
<td align="right">4</td>
<td align="right">77.5</td>
<td align="right">-32.5</td>
<td align="right">130</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">ALB</td>
<td align="right">2020</td>
<td align="right">7</td>
<td align="right">82.5</td>
<td align="right">-32.5</td>
<td align="right">160</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">BET+YFT</td>
<td align="right">2020</td>
<td align="right">10</td>
<td align="right">87.5</td>
<td align="right">-32.5</td>
<td align="right">190</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">BET+YFT</td>
<td align="right">2021</td>
<td align="right">1</td>
<td align="right">72.5</td>
<td align="right">-27.5</td>
<td align="right">200</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">ALB</td>
<td align="right">2021</td>
<td align="right">4</td>
<td align="right">77.5</td>
<td align="right">-27.5</td>
<td align="right">230</td>
</tr>
</tbody>
</table>
<table style="width:100%;" class="table">
<caption>Headers for observed captures (synthetic data)</caption>
<colgroup>
<col width="7%">
<col width="10%">
<col width="7%">
<col width="8%">
<col width="7%">
<col width="8%">
<col width="7%">
<col width="10%">
<col width="14%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th align="left">flag</th>
<th align="left">target</th>
<th align="right">year</th>
<th align="right">month</th>
<th align="right">lon</th>
<th align="right">lat</th>
<th align="left">code</th>
<th align="left">status</th>
<th align="left">age_class</th>
<th align="right">n_captures</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">ALB</td>
<td align="right">2020</td>
<td align="right">4</td>
<td align="right">77.5</td>
<td align="right">-32.5</td>
<td align="left">DIW</td>
<td align="left">alive</td>
<td align="left">adult</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">ALB</td>
<td align="right">2020</td>
<td align="right">4</td>
<td align="right">77.5</td>
<td align="right">-32.5</td>
<td align="left">DIW</td>
<td align="left">alive</td>
<td align="left">immature</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">ALB</td>
<td align="right">2020</td>
<td align="right">4</td>
<td align="right">77.5</td>
<td align="right">-32.5</td>
<td align="left">DIW</td>
<td align="left">dead</td>
<td align="left">NA</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">ALB</td>
<td align="right">2020</td>
<td align="right">4</td>
<td align="right">77.5</td>
<td align="right">-32.5</td>
<td align="left">DIW</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">ALB</td>
<td align="right">2020</td>
<td align="right">4</td>
<td align="right">77.5</td>
<td align="right">-32.5</td>
<td align="left">DIW</td>
<td align="left">alive</td>
<td align="left">adult</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">ALB</td>
<td align="right">2020</td>
<td align="right">4</td>
<td align="right">77.5</td>
<td align="right">-32.5</td>
<td align="left">DIW</td>
<td align="left">alive</td>
<td align="left">NA</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>The synthetic data are provided at a 5x5 degree spatial resolution,
where the longitude and latitude fields provide the mid-point of the 5
degree square grid cell.</p>
<div class="section level3">
<h3 id="check-that-synthetic-observer-data-meet-minimum-requirements">Check that synthetic observer data meet minimum requirements<a class="anchor" aria-label="anchor" href="#check-that-synthetic-observer-data-meet-minimum-requirements"></a>
</h3>
<p>Get totals for initial observed effort and captures:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N_EFFORT</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obs_effort</span><span class="op">$</span><span class="va">observer_effort</span><span class="op">)</span></span>
<span><span class="va">N_CAPTURES</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obs_captures</span><span class="op">$</span><span class="va">n_captures</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_effort</span>   <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_observed_effort.html">check_observed_effort</a></span><span class="op">(</span><span class="va">obs_effort</span><span class="op">)</span></span>
<span><span class="va">obs_captures</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_observed_captures.html">check_observed_captures</a></span><span class="op">(</span><span class="va">obs_captures</span><span class="op">)</span></span></code></pre></div>
<p>Get the variables that define the stratification of the observer data
(<code>strata_vars</code>), and ensure that they are present in both the
observer effort and capture data:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strata_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">obs_effort</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">obs_effort</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"observer_effort"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">strata_vars</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">obs_effort</span><span class="op">)</span>, <span class="va">strata_vars</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">obs_captures</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Check that each record in <code>obs_captures</code> matches at most
one record in <code>obs_effort</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_effort</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">obs_captures</span>, by <span class="op">=</span> <span class="va">strata_vars</span>, relationship <span class="op">=</span> <span class="st">"one-to-many"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre></div>
<p>Check for multiple records in the observer effort data for a
particular strata, which would introduce duplication in captures data
when they are joined:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># effort records per strata</span></span>
<span><span class="va">effort_records_per_strata</span> <span class="op">&lt;-</span> <span class="va">obs_effort</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by_all.html" class="external-link">group_by_at</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">strata_vars</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.</span>, n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">effort_records_per_strata</span><span class="op">$</span><span class="va">n</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Filter out captures for strata with no corresponding observed effort
data:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_captures</span> <span class="op">&lt;-</span> <span class="va">obs_captures</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">semi_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">obs_effort</span>, by <span class="op">=</span> <span class="va">strata_vars</span><span class="op">)</span></span></code></pre></div>
<p>Summarise remaining observed effort and captures after initial
filtering:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Observed effort after check_observed_effort accounts for "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obs_effort</span><span class="op">$</span><span class="va">observer_effort</span><span class="op">)</span><span class="op">/</span><span class="va">N_EFFORT</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"% of total observed effort provided by User"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Observed effort after check_observed_effort accounts for 100% of total observed effort provided by User</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Observed captures after check_observed_effort and check_observed_captures accounts for "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obs_captures</span><span class="op">$</span><span class="va">n_captures</span><span class="op">)</span><span class="op">/</span><span class="va">N_CAPTURES</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"% of total observed captures provided by User"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Observed captures after check_observed_effort and check_observed_captures accounts for 100% of total observed captures provided by User</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="access-biological-input-data-for-the-risk-assessment-model">Access biological input data for the risk assessment model<a class="anchor" aria-label="anchor" href="#access-biological-input-data-for-the-risk-assessment-model"></a>
</h2>
<p>As described above, this section has been updated for the 2025 CCSBT
risk assessment, to allow preparation of data inputs with different sets
of biological inputs.</p>
<p>Biological input data for the risk assessment model, including
demographic parameters and seabird density maps, are available through
the <code>sefraInputs</code> package. The biological inputs can be
accessed using the <code>sefra_data</code> function.</p>
<p>Calling the <code>sefra_data</code> function with no arguments
returns a summary of available biological inputs:</p>
<pre><code><span><span class="co">## Available SEFRA data:</span></span></code></pre>
<pre><code><span><span class="co">##              name                        description             created</span></span>
<span><span class="co">## 1       inputsBio                          reference 2025-02-10 15:14:40</span></span>
<span><span class="co">## 2       inputsBio                     2024_CCSBT_SRA 2025-02-10 15:14:40</span></span>
<span><span class="co">## 3 cryptic_capture                          reference 2025-02-10 15:14:40</span></span>
<span><span class="co">## 4    density_maps                     2024_CCSBT_SRA 2025-02-10 15:14:44</span></span>
<span><span class="co">## 5    density_maps 2024_CCSBT_SRA_combined_range_maps 2025-02-10 15:14:45</span></span>
<span><span class="co">## 6    density_maps                          reference 2025-02-10 15:14:47</span></span>
<span><span class="co">##                  version id</span></span>
<span><span class="co">## 1 20250210T141440Z-4aa76  1</span></span>
<span><span class="co">## 2 20250210T141440Z-7ded8  2</span></span>
<span><span class="co">## 3 20250210T141440Z-166dd  1</span></span>
<span><span class="co">## 4 20250210T141444Z-6ebf4  1</span></span>
<span><span class="co">## 5 20250210T141445Z-9d68b  2</span></span>
<span><span class="co">## 6 20250210T141447Z-f16ec  3</span></span></code></pre>
<p>Other data objects that are required, or helpful, when preparing data
inputs can be accessed through a call to <code><a href="https://rdrr.io/r/utils/data.html" class="external-link">data()</a></code>. To check
what data are available in the current package build, use:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"sefraInputs"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="demographic-parameters">Demographic parameters<a class="anchor" aria-label="anchor" href="#demographic-parameters"></a>
</h3>
<p>To load the current biological inputs into the global environment
(i.e., the <code>inputsBio</code> object) , we select the object where
<code>description = "reference"</code>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sefra_data.html">sefra_data</a></span><span class="op">(</span><span class="st">"inputsBio"</span>, description <span class="op">=</span> <span class="st">"reference"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loaded data:</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |name      |description |created             |version                | id|</span></span>
<span><span class="co">## |:---------|:-----------|:-------------------|:----------------------|--:|</span></span>
<span><span class="co">## |inputsBio |reference   |2025-02-10 15:14:40 |20250210T141440Z-4aa76 |  1|</span></span></code></pre>
<p>The biological inputs for the 2024 CCSBT risk assessment are also
available (i.e., <code>description = "2024_CCSBT_SRA"</code>).
Biological inputs will updated and added the <code>sefraInputs</code>
package as the project progresses.</p>
<p><code>inputsBio</code> is a list object, with each element providing
the inputs for one biological or demographic variable. Each set of
biological inputs contains the following data frames: sp_codes,
sp_groups, breeding_season, p_nest, breeding_phenology, p_southern,
N_BP, P_B, S_curr, S_opt, A_curr, A_opt. This approach is intended to
facilitate data preparation with different biological inputs, e.g., for
sensitivity analyses.</p>
<p>Here, we prepare the synthetic observer dataset using the current
best estimates of the biological inputs:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inputs_bio_option</span> <span class="op">&lt;-</span> <span class="va">inputsBio</span></span></code></pre></div>
<p>Create a separate object for each element of
<code>inputs_bio_option</code>:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">inputs_bio_option</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="va">i</span>, value <span class="op">=</span> <span class="va">inputs_bio_option</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, envir <span class="op">=</span> <span class="va">.GlobalEnv</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Created "</span>, <span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Created sp_codes</span></span></code></pre>
<pre><code><span><span class="co">## Created sp_groups</span></span></code></pre>
<pre><code><span><span class="co">## Created breeding_season</span></span></code></pre>
<pre><code><span><span class="co">## Created p_nest</span></span></code></pre>
<pre><code><span><span class="co">## Created breeding_phenology</span></span></code></pre>
<pre><code><span><span class="co">## Created p_southern</span></span></code></pre>
<pre><code><span><span class="co">## Created N_BP</span></span></code></pre>
<pre><code><span><span class="co">## Created P_B</span></span></code></pre>
<pre><code><span><span class="co">## Created S_curr</span></span></code></pre>
<pre><code><span><span class="co">## Created S_opt</span></span></code></pre>
<pre><code><span><span class="co">## Created A_curr</span></span></code></pre>
<pre><code><span><span class="co">## Created A_opt</span></span></code></pre>
<p>To retrieve the species list:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="st">"species"</span>, value <span class="op">=</span> <span class="va">inputs_bio_option</span><span class="op">[[</span><span class="st">"sp_codes"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="st">"code"</span><span class="op">]</span>, envir <span class="op">=</span> <span class="va">.GlobalEnv</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="seabird-density-maps">Seabird density maps<a class="anchor" aria-label="anchor" href="#seabird-density-maps"></a>
</h3>
<p>To load the current seabird density maps into the global environment
(i.e., the <code>density_maps</code> object) , we select the object
where <code>description = "reference"</code>:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sefra_data.html">sefra_data</a></span><span class="op">(</span><span class="st">"density_maps"</span>, description <span class="op">=</span> <span class="st">"reference"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loaded data:</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |name         |description |created             |version                | id|</span></span>
<span><span class="co">## |:------------|:-----------|:-------------------|:----------------------|--:|</span></span>
<span><span class="co">## |density_maps |reference   |2025-02-10 15:14:47 |20250210T141447Z-f16ec |  3|</span></span></code></pre>
<p>Density maps will updated and added the <code>sefraInputs</code>
package as the project progresses, e.g., updated density maps for
selected species with additional tracking data, and density maps
incorporating range maps from Birdlife International.</p>
<p>Here, we prepare the synthetic observer dataset using the current
best estimates of the biological inputs:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">density_maps_option</span> <span class="op">&lt;-</span> <span class="va">density_maps</span></span></code></pre></div>
<p>Create a separate object for each element of
<code>density_maps</code>:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">density_maps_option</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"densities_"</span>, <span class="va">i</span><span class="op">)</span>, value <span class="op">=</span> <span class="va">density_maps_option</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, envir <span class="op">=</span> <span class="va">.GlobalEnv</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Created "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"densities_"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Created densities_dam</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_dbn</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_dcr</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_dcu</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_der</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_dic</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_dim</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_dip</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_diq</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_diw</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_dix</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_dks</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_dqs</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_dsb</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_pci</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_pcn</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_pcw</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_phe</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_phu</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_prk</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_pro</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_tqh</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_tqw</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_twd</span></span></code></pre>
<pre><code><span><span class="co">## Created densities_dnb</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="spatial-grid-definition">Spatial grid definition<a class="anchor" aria-label="anchor" href="#spatial-grid-definition"></a>
</h3>
<p>The seabird density maps all have the same 5 degree spatial
structure. This 5 degree grid (called <code>grid</code>) is included in
the <code>sefraInputs</code> package, to facilitate the preparation of
observed effort data with a spatial structure and coordinate reference
system that is consistent with the seabird density maps (see
<code><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">?grid</a></code>). This consistency in spatial structures and
coordinate reference systems is required to estimate the spatial overlap
between fishing effort and seabird populations.</p>
<p>The grid is accessible using:</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"grid"</span>, package <span class="op">=</span> <span class="st">"sefraInputs"</span><span class="op">)</span></span></code></pre></div>
<p>The <code>grid</code> is a <code>sf</code> object, with each 5 x 5
degree cell represented as a polygon. The <code>grid</code> has an
associated coordinate reference system (see <code>st_crs(grid</code>).
During the data preparation, the User’s observer data must be converted
to a <code>sf</code> object, with the same coordinate reference system
as <code>grid</code>. This is done for the example dataset in Section
‘Format <code>obs_data</code> for calculation of density overlap’.</p>
</div>
</div>
<div class="section level2">
<h2 id="seabird-species-and-species-groupings-of-catchabilities">Seabird species, and species groupings of catchabilities<a class="anchor" aria-label="anchor" href="#seabird-species-and-species-groupings-of-catchabilities"></a>
</h2>
<div class="section level3">
<h3 id="species-in-the-risk-assessment-model">Species in the risk assessment model<a class="anchor" aria-label="anchor" href="#species-in-the-risk-assessment-model"></a>
</h3>
<p>The <code>sp_codes</code> data frame provides numeric species
identifiers (<code>id_species</code>), species codes (<code>code</code>
- using FAO ASFIS three-alpha codes where available), and common names
(<code>common_name</code>), for the seabird species included in the risk
assessment model:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_codes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">id_species</th>
<th align="left">code</th>
<th align="left">common_name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">DIW</td>
<td align="left">Gibson’s albatross</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">DQS</td>
<td align="left">Antipodean albatross</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">DIX</td>
<td align="left">Wandering albatross</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">DBN</td>
<td align="left">Tristan albatross</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">DAM</td>
<td align="left">Amsterdam albatross</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">DIP</td>
<td align="left">Southern royal albatross</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="species-groupings-for-estimation-of-catchabilities">Species groupings for estimation of catchabilities<a class="anchor" aria-label="anchor" href="#species-groupings-for-estimation-of-catchabilities"></a>
</h3>
<p>Catchability parameters define catch rates per unit of observed
density overlap. Catchability parameters can be shared across species,
e.g. on the basis of similarities in behaviour when attending fishing
vessels.</p>
<p>The <code>sp_groups</code> data frame is used to define the species
groupings used to estimate catchabilities, i.e., the
<code>species_group</code> and <code>id_species_group</code>
variables.</p>
<p>The <code>sp_groups</code> object in
<code>inputsBio[['reference']]</code> provides the species groupings
used in the 2024 seabird risk assessment:</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_groups</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">id_species_group</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">id_species_group</span>, <span class="va">species_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">id_species_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">id_species_group</th>
<th align="left">species_group</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Wandering albatross</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Royal albatross</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Small albatross</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Sooty albatross</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">Medium petrel</td>
</tr>
</tbody>
</table>
<p>However, the species groupings can be updated by the User for
application to their observer data (see the following sub-section).</p>
<p>The <code>sp_groups</code> data frame also includes records for
seabird captures that were not recorded to a species level. This allows
all observed seabird captures to inform the risk assessment model, even
if the captures were not identified to a species-level. The variable
<code>taxonomic_resolution</code> defines whether the <code>code</code>
reflects identifications to a <code>species</code> level, species
complex (<code>complex</code>), <code>genus</code> or
<code>family</code> level.</p>
<p>The data field <code>fao_code</code> is a logical variable indicating
whether the <code>code</code> is a FAO ASFIS code (<code>TRUE</code>) or
not (<code>FALSE</code>). <code>id_code</code> provides a unique
(integer) identifier for each record.</p>
<p>Codes are also provided for captures that are identified to a finer
taxonomic resolution than genus, but a coarser resolution than species.
We refer to these as been having identified to a ‘species complex’
level. The following records in <code>sp_groups</code> give the codes
that should be used for captures identified to a ‘species complex’
level:</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_groups</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">taxonomic_resolution</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"complex"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="11%">
<col width="32%">
<col width="4%">
<col width="5%">
<col width="4%">
<col width="6%">
<col width="5%">
<col width="2%">
<col width="3%">
<col width="3%">
<col width="1%">
<col width="7%">
<col width="3%">
<col width="3%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">common_name</th>
<th align="left">scientific_name</th>
<th align="left">genus</th>
<th align="left">family</th>
<th align="left">species_group</th>
<th align="left">catchability_group</th>
<th align="left">capture_group</th>
<th align="right">id_code</th>
<th align="right">id_genus</th>
<th align="right">id_family</th>
<th align="left">code</th>
<th align="left">taxonomic_resolution</th>
<th align="left">fao_code</th>
<th align="right">id_species</th>
<th align="right">id_species_group</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Gibson’s and Antipodean albatross</td>
<td align="left">Diomedea antipodensis gibsoni and D. a.
antipodensis</td>
<td align="left">Diomedea</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Great albatross</td>
<td align="right">26</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">DGA</td>
<td align="left">complex</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">Royal albatrosses</td>
<td align="left">Diomedea epomophora and D. sanfordi</td>
<td align="left">Diomedea</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Great albatross</td>
<td align="right">27</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">DRA</td>
<td align="left">complex</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Yellow-nosed albatrosses</td>
<td align="left">Thalassarche chlororhynchos and T. carteri</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Mollymawk</td>
<td align="right">28</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">DYN</td>
<td align="left">complex</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">Shy-type albatross</td>
<td align="left">Thalassarche cauta and T. c. steadi</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Mollymawk</td>
<td align="right">29</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">DST</td>
<td align="left">complex</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Black-browed albatrosses</td>
<td align="left">Thalassarche melanophris and T. impavida</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Mollymawk</td>
<td align="right">30</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">DBB</td>
<td align="left">complex</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">Buller’s albatross</td>
<td align="left">Thalassarche bulleri bulleri and T. bulleri platei</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Mollymawk</td>
<td align="right">31</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">DIB</td>
<td align="left">complex</td>
<td align="left">TRUE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Wandering albatross complex</td>
<td align="left">Diomedea exulans, D. dabbenena, D. amsterdamensis, D.
antipodensis gibsoni and D. a. antipodensis</td>
<td align="left">Diomedea</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Great albatross</td>
<td align="right">32</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">DWC</td>
<td align="left">complex</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">Petrel complex</td>
<td align="left">Procellaria parkinsoni, P. westlandica and P.
aequinoctialis</td>
<td align="left">Procellaria</td>
<td align="left">Procellariidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Medium petrel</td>
<td align="right">33</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="left">PRZ</td>
<td align="left">complex</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p>The following records in <code>sp_groups</code> give the codes that
should be used for captures identified to a genus level:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_groups</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">taxonomic_resolution</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"genus"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="8%">
<col width="8%">
<col width="6%">
<col width="7%">
<col width="6%">
<col width="9%">
<col width="7%">
<col width="3%">
<col width="4%">
<col width="4%">
<col width="2%">
<col width="10%">
<col width="4%">
<col width="5%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left">common_name</th>
<th align="left">scientific_name</th>
<th align="left">genus</th>
<th align="left">family</th>
<th align="left">species_group</th>
<th align="left">catchability_group</th>
<th align="left">capture_group</th>
<th align="right">id_code</th>
<th align="right">id_genus</th>
<th align="right">id_family</th>
<th align="left">code</th>
<th align="left">taxonomic_resolution</th>
<th align="left">fao_code</th>
<th align="right">id_species</th>
<th align="right">id_species_group</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Diomedea spp</td>
<td align="left">Diomedea spp</td>
<td align="left">Diomedea</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Great albatross</td>
<td align="right">34</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">DIZ</td>
<td align="left">genus</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">Thalassarche spp</td>
<td align="left">Thalassarche spp</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Mollymawk</td>
<td align="right">35</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">THZ</td>
<td align="left">genus</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Phoebetria spp</td>
<td align="left">Phoebetria spp</td>
<td align="left">Phoebetria</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Sooty albatross</td>
<td align="right">36</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="left">PHZ</td>
<td align="left">genus</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">Procellaria spp</td>
<td align="left">Procellaria spp</td>
<td align="left">Procellaria</td>
<td align="left">Procellariidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Medium petrel</td>
<td align="right">37</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="left">PTZ</td>
<td align="left">genus</td>
<td align="left">TRUE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p>The following records in <code>sp_groups</code> give the codes that
should be used for captures identified to a family level:</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_groups</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">taxonomic_resolution</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"family"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="7%">
<col width="8%">
<col width="3%">
<col width="7%">
<col width="7%">
<col width="10%">
<col width="7%">
<col width="4%">
<col width="4%">
<col width="5%">
<col width="2%">
<col width="11%">
<col width="4%">
<col width="5%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left">common_name</th>
<th align="left">scientific_name</th>
<th align="left">genus</th>
<th align="left">family</th>
<th align="left">species_group</th>
<th align="left">catchability_group</th>
<th align="left">capture_group</th>
<th align="right">id_code</th>
<th align="right">id_genus</th>
<th align="right">id_family</th>
<th align="left">code</th>
<th align="left">taxonomic_resolution</th>
<th align="left">fao_code</th>
<th align="right">id_species</th>
<th align="right">id_species_group</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Diomedeidae</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Unassigned</td>
<td align="right">38</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="left">ALZ</td>
<td align="left">family</td>
<td align="left">TRUE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">Procellariidae</td>
<td align="left">Procellariidae</td>
<td align="left">NA</td>
<td align="left">Procellariidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Unassigned</td>
<td align="right">39</td>
<td align="right">NA</td>
<td align="right">2</td>
<td align="left">PRX</td>
<td align="left">family</td>
<td align="left">TRUE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p>There is also a record in <code>sp_groups</code> with the code that
should be used for captures that were not identified to a family
level:</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_groups</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">taxonomic_resolution</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"bird"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="6%">
<col width="8%">
<col width="3%">
<col width="3%">
<col width="7%">
<col width="10%">
<col width="7%">
<col width="4%">
<col width="5%">
<col width="5%">
<col width="2%">
<col width="11%">
<col width="5%">
<col width="6%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="left">common_name</th>
<th align="left">scientific_name</th>
<th align="left">genus</th>
<th align="left">family</th>
<th align="left">species_group</th>
<th align="left">catchability_group</th>
<th align="left">capture_group</th>
<th align="right">id_code</th>
<th align="right">id_genus</th>
<th align="right">id_family</th>
<th align="left">code</th>
<th align="left">taxonomic_resolution</th>
<th align="left">fao_code</th>
<th align="right">id_species</th>
<th align="right">id_species_group</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Bird</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Unassigned</td>
<td align="right">40</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">BLZ</td>
<td align="left">bird</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr></tbody>
</table>
<p>Users must map their species codings for seabird captures to the
corresponding values in <code>sp_codes</code> and
<code>sp_groups</code>, so that captures are assigned to the correct
species group for estimation of catchabilities.</p>
<p>Additional records in <code>sp_groups</code> may be required to
facilitate this mapping, for example, if there are captures with codes
that reflect identifications to a finer taxonomic resolution than genus,
but with a coarser resolution than species. Users should request
additional records by creating an <a href="https://github.com/sefra-seabirds/sefraInputs/issues" class="external-link">Issue for
the <code>sefraInputs</code> Github repository</a>.</p>
<p>It is essential that Users request additional records to be added to
the <code>sp_groups</code> object in the <code>R</code> package if
necessary, rather than working off a modified local version of
<code>sp_groups</code>. This will ensure that all members have
consistent codes (<code>code</code>) and identifiers
(<code>id_code</code>) in their captures datasets.</p>
</div>
<div class="section level3">
<h3 id="updating-species-groupings-for-estimation-of-catchabilities">Updating species groupings for estimation of catchabilities<a class="anchor" aria-label="anchor" href="#updating-species-groupings-for-estimation-of-catchabilities"></a>
</h3>
<p>Species groups may need to be adjusted for application to the User’s
observer dataset.</p>
<p>If this is required, the function <code>assign_species_groups</code>
should be used to update the <code>sp_groups</code> object, based on a
lookup table provided by the User called
<code>species_group_definitions</code>. The updated species groups in
<code>sp_groups</code> will then propagate through to the observed
captures and observed overlap.</p>
<p>The User should not manually adjust species groups directly in the
data objects, i.e., do not directly adjust <code>species_group</code> or
<code>id_species_group</code> in <code>obs_data</code>,
<code>obs_overlap</code>, <code>overlap_o</code>,
<code>captures_o</code>, etc.</p>
<p>For example, to define species groups using genus, i.e., grouping all
great albatrosses (Diomedea species) together, the User should run the
following:</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initial species groupings</span></span>
<span><span class="va">sp_groups_init</span> <span class="op">&lt;-</span> <span class="va">sp_groups</span></span>
<span></span>
<span><span class="co"># Updated species group definitions for separate groups per genus</span></span>
<span><span class="va">genus_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">sp_groups</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span></span>
<span><span class="va">genus_list</span> <span class="op">&lt;-</span> <span class="va">genus_list</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">genus_list</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">species_group_definitions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id_species_group <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">genus_list</span><span class="op">)</span>, genus <span class="op">=</span> <span class="va">genus_list</span>, species_group <span class="op">=</span> <span class="va">genus_list</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="va">latex_special_characters</span>, <span class="va">species_group_definitions</span><span class="op">$</span><span class="va">species_group</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="va">punctuation_characters</span>, <span class="va">species_group_definitions</span><span class="op">$</span><span class="va">species_group</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assign updated species groups</span></span>
<span><span class="va">sp_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assign_species_groups.html">assign_species_groups</a></span><span class="op">(</span><span class="va">sp_groups</span>, <span class="va">species_group_definitions</span>, by <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span></span></code></pre></div>
<p>Species group names (<code>species_group</code>) can have spaces, but
should not have punctuation characters, or special characters in LaTeX,
e.g. underscores (_), ampersands (&amp;), dollar signs ($) etc.</p>
<p>To prepare the synthetic data, we use the species groups from the
2024 CCSBT seabird risk assessment. Members should also use these
species groups when preparing their data for inclusion in the combined
dataset (i.e., the dataset that includes data from all participating
members), as consistent species groups must be used by all members.</p>
<p>First, ensure that the <code>sp_groups</code> has not been
updated:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">sp_groups</span>, <span class="va">inputs_bio_option</span><span class="op">[[</span><span class="st">"sp_groups"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Resetting species groups to inputs_bio_option[['sp_groups']]"</span><span class="op">)</span></span>
<span>  <span class="va">sp_groups</span> <span class="op">&lt;-</span> <span class="va">inputs_bio_option</span><span class="op">[[</span><span class="st">"sp_groups"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The species groups are:</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">sp_groups</span>, caption <span class="op">=</span> <span class="st">"Species groups used to prepare the synthetic dataset."</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Species groups used to prepare the synthetic dataset.</caption>
<colgroup>
<col width="11%">
<col width="31%">
<col width="4%">
<col width="4%">
<col width="6%">
<col width="6%">
<col width="5%">
<col width="2%">
<col width="2%">
<col width="3%">
<col width="1%">
<col width="6%">
<col width="2%">
<col width="3%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">common_name</th>
<th align="left">scientific_name</th>
<th align="left">genus</th>
<th align="left">family</th>
<th align="left">species_group</th>
<th align="left">catchability_group</th>
<th align="left">capture_group</th>
<th align="right">id_code</th>
<th align="right">id_genus</th>
<th align="right">id_family</th>
<th align="left">code</th>
<th align="left">taxonomic_resolution</th>
<th align="left">fao_code</th>
<th align="right">id_species</th>
<th align="right">id_species_group</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Gibson’s albatross</td>
<td align="left">Diomedea antipodensis gibsoni</td>
<td align="left">Diomedea</td>
<td align="left">Diomedeidae</td>
<td align="left">Wandering albatross</td>
<td align="left">Wandering albatross</td>
<td align="left">Great albatross</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">DIW</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Antipodean albatross</td>
<td align="left">Diomedea antipodensis antipodensis</td>
<td align="left">Diomedea</td>
<td align="left">Diomedeidae</td>
<td align="left">Wandering albatross</td>
<td align="left">Wandering albatross</td>
<td align="left">Great albatross</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">DQS</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Wandering albatross</td>
<td align="left">Diomedea exulans</td>
<td align="left">Diomedea</td>
<td align="left">Diomedeidae</td>
<td align="left">Wandering albatross</td>
<td align="left">Wandering albatross</td>
<td align="left">Great albatross</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">DIX</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Tristan albatross</td>
<td align="left">Diomedea dabbenena</td>
<td align="left">Diomedea</td>
<td align="left">Diomedeidae</td>
<td align="left">Wandering albatross</td>
<td align="left">Wandering albatross</td>
<td align="left">Great albatross</td>
<td align="right">4</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">DBN</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Amsterdam albatross</td>
<td align="left">Diomedea amsterdamensis</td>
<td align="left">Diomedea</td>
<td align="left">Diomedeidae</td>
<td align="left">Wandering albatross</td>
<td align="left">Wandering albatross</td>
<td align="left">Great albatross</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">DAM</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">5</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Southern royal albatross</td>
<td align="left">Diomedea epomophora</td>
<td align="left">Diomedea</td>
<td align="left">Diomedeidae</td>
<td align="left">Royal albatross</td>
<td align="left">Royal albatross</td>
<td align="left">Great albatross</td>
<td align="right">6</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">DIP</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">6</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Northern royal albatross</td>
<td align="left">Diomedea sanfordi</td>
<td align="left">Diomedea</td>
<td align="left">Diomedeidae</td>
<td align="left">Royal albatross</td>
<td align="left">Royal albatross</td>
<td align="left">Great albatross</td>
<td align="right">7</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">DIQ</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">7</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Atlantic yellow-nosed albatross</td>
<td align="left">Thalassarche chlororhynchos</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">Small albatross</td>
<td align="left">Mollymawk</td>
<td align="left">Mollymawk</td>
<td align="right">8</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">DCR</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">8</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">Indian yellow-nosed albatross</td>
<td align="left">Thalassarche carteri</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">Small albatross</td>
<td align="left">Mollymawk</td>
<td align="left">Mollymawk</td>
<td align="right">9</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">TQH</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">9</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Black-browed albatross</td>
<td align="left">Thalassarche melanophris</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">Small albatross</td>
<td align="left">Mollymawk</td>
<td align="left">Mollymawk</td>
<td align="right">10</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">DIM</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">10</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">Campbell black-browed albatross</td>
<td align="left">Thalassarche impavida</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">Small albatross</td>
<td align="left">Mollymawk</td>
<td align="left">Mollymawk</td>
<td align="right">11</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">TQW</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">11</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Shy albatross</td>
<td align="left">Thalassarche cauta</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">Small albatross</td>
<td align="left">Mollymawk</td>
<td align="left">Mollymawk</td>
<td align="right">12</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">DCU</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">12</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">New Zealand white-capped albatross</td>
<td align="left">Thalassarche cauta steadi</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">Small albatross</td>
<td align="left">Mollymawk</td>
<td align="left">Mollymawk</td>
<td align="right">13</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">TWD</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">13</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Salvin’s albatross</td>
<td align="left">Thalassarche salvini</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">Small albatross</td>
<td align="left">Mollymawk</td>
<td align="left">Mollymawk</td>
<td align="right">14</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">DKS</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">14</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">Chatham Island albatross</td>
<td align="left">Thalassarche eremita</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">Small albatross</td>
<td align="left">Mollymawk</td>
<td align="left">Mollymawk</td>
<td align="right">15</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">DER</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">15</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Grey-headed albatross</td>
<td align="left">Thalassarche chrysostoma</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">Small albatross</td>
<td align="left">Mollymawk</td>
<td align="left">Mollymawk</td>
<td align="right">16</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">DIC</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">16</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">Southern Buller’s albatross</td>
<td align="left">Thalassarche bulleri bulleri</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">Small albatross</td>
<td align="left">Mollymawk</td>
<td align="left">Mollymawk</td>
<td align="right">17</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">DSB</td>
<td align="left">species</td>
<td align="left">FALSE</td>
<td align="right">17</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Northern Buller’s albatross</td>
<td align="left">Thalassarche bulleri platei</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">Small albatross</td>
<td align="left">Mollymawk</td>
<td align="left">Mollymawk</td>
<td align="right">18</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">DNB</td>
<td align="left">species</td>
<td align="left">FALSE</td>
<td align="right">18</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">Sooty albatross</td>
<td align="left">Phoebetria fusca</td>
<td align="left">Phoebetria</td>
<td align="left">Diomedeidae</td>
<td align="left">Sooty albatross</td>
<td align="left">Sooty albatross</td>
<td align="left">Sooty albatross</td>
<td align="right">19</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="left">PHU</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">19</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">Light-mantled sooty albatross</td>
<td align="left">Phoebetria palpebrata</td>
<td align="left">Phoebetria</td>
<td align="left">Diomedeidae</td>
<td align="left">Sooty albatross</td>
<td align="left">Sooty albatross</td>
<td align="left">Sooty albatross</td>
<td align="right">20</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="left">PHE</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">20</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">Grey petrel</td>
<td align="left">Procellaria cinerea</td>
<td align="left">Procellaria</td>
<td align="left">Procellariidae</td>
<td align="left">Medium petrel</td>
<td align="left">Medium petrel</td>
<td align="left">Medium petrel</td>
<td align="right">21</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="left">PCI</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">21</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">Black petrel</td>
<td align="left">Procellaria parkinsoni</td>
<td align="left">Procellaria</td>
<td align="left">Procellariidae</td>
<td align="left">Medium petrel</td>
<td align="left">Medium petrel</td>
<td align="left">Medium petrel</td>
<td align="right">22</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="left">PRK</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">22</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">Westland petrel</td>
<td align="left">Procellaria westlandica</td>
<td align="left">Procellaria</td>
<td align="left">Procellariidae</td>
<td align="left">Medium petrel</td>
<td align="left">Medium petrel</td>
<td align="left">Medium petrel</td>
<td align="right">23</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="left">PCW</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">23</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">White-chinned petrel</td>
<td align="left">Procellaria aequinoctialis</td>
<td align="left">Procellaria</td>
<td align="left">Procellariidae</td>
<td align="left">Medium petrel</td>
<td align="left">Medium petrel</td>
<td align="left">Medium petrel</td>
<td align="right">24</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="left">PRO</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">24</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">Spectacled petrel</td>
<td align="left">Procellaria conspicillata</td>
<td align="left">Procellaria</td>
<td align="left">Procellariidae</td>
<td align="left">Medium petrel</td>
<td align="left">Medium petrel</td>
<td align="left">Medium petrel</td>
<td align="right">25</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="left">PCN</td>
<td align="left">species</td>
<td align="left">TRUE</td>
<td align="right">25</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">Gibson’s and Antipodean albatross</td>
<td align="left">Diomedea antipodensis gibsoni and D. a.
antipodensis</td>
<td align="left">Diomedea</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Great albatross</td>
<td align="right">26</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">DGA</td>
<td align="left">complex</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Royal albatrosses</td>
<td align="left">Diomedea epomophora and D. sanfordi</td>
<td align="left">Diomedea</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Great albatross</td>
<td align="right">27</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">DRA</td>
<td align="left">complex</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">Yellow-nosed albatrosses</td>
<td align="left">Thalassarche chlororhynchos and T. carteri</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Mollymawk</td>
<td align="right">28</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">DYN</td>
<td align="left">complex</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Shy-type albatross</td>
<td align="left">Thalassarche cauta and T. c. steadi</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Mollymawk</td>
<td align="right">29</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">DST</td>
<td align="left">complex</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">Black-browed albatrosses</td>
<td align="left">Thalassarche melanophris and T. impavida</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Mollymawk</td>
<td align="right">30</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">DBB</td>
<td align="left">complex</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Buller’s albatross</td>
<td align="left">Thalassarche bulleri bulleri and T. bulleri platei</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Mollymawk</td>
<td align="right">31</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">DIB</td>
<td align="left">complex</td>
<td align="left">TRUE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">Wandering albatross complex</td>
<td align="left">Diomedea exulans, D. dabbenena, D. amsterdamensis, D.
antipodensis gibsoni and D. a. antipodensis</td>
<td align="left">Diomedea</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Great albatross</td>
<td align="right">32</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">DWC</td>
<td align="left">complex</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Petrel complex</td>
<td align="left">Procellaria parkinsoni, P. westlandica and P.
aequinoctialis</td>
<td align="left">Procellaria</td>
<td align="left">Procellariidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Medium petrel</td>
<td align="right">33</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="left">PRZ</td>
<td align="left">complex</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">Diomedea spp</td>
<td align="left">Diomedea spp</td>
<td align="left">Diomedea</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Great albatross</td>
<td align="right">34</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">DIZ</td>
<td align="left">genus</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Thalassarche spp</td>
<td align="left">Thalassarche spp</td>
<td align="left">Thalassarche</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Mollymawk</td>
<td align="right">35</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">THZ</td>
<td align="left">genus</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">Phoebetria spp</td>
<td align="left">Phoebetria spp</td>
<td align="left">Phoebetria</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Sooty albatross</td>
<td align="right">36</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="left">PHZ</td>
<td align="left">genus</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Procellaria spp</td>
<td align="left">Procellaria spp</td>
<td align="left">Procellaria</td>
<td align="left">Procellariidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Medium petrel</td>
<td align="right">37</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="left">PTZ</td>
<td align="left">genus</td>
<td align="left">TRUE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">Diomedeidae</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">Diomedeidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Unassigned</td>
<td align="right">38</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="left">ALZ</td>
<td align="left">family</td>
<td align="left">TRUE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Procellariidae</td>
<td align="left">Procellariidae</td>
<td align="left">NA</td>
<td align="left">Procellariidae</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Unassigned</td>
<td align="right">39</td>
<td align="right">NA</td>
<td align="right">2</td>
<td align="left">PRX</td>
<td align="left">family</td>
<td align="left">TRUE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">Bird</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Unassigned</td>
<td align="right">40</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">BLZ</td>
<td align="left">bird</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p>Save <code>sp_groups</code> and (if necessary)
<code>species_groups_definitions</code> for use in the risk assessment
model:</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">sp_groups</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_data</span>, <span class="st">"sp_groups.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"species_group_definitions"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">species_group_definitions</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_data</span>, <span class="st">"species_group_definitions.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="prepare-observed-effort-and-captures-data">Prepare observed effort and captures data<a class="anchor" aria-label="anchor" href="#prepare-observed-effort-and-captures-data"></a>
</h2>
<div class="section level3">
<h3 id="specify-the-time-period-for-observations-used-to-estimate-catchabilities">Specify the time-period for observations used to estimate
catchabilities<a class="anchor" aria-label="anchor" href="#specify-the-time-period-for-observations-used-to-estimate-catchabilities"></a>
</h3>
<p>There is a compromise when specifying the time-period from which
observer data are used to estimate catchabilities. Seabird captures are
relatively rare, and so longer time-series of observer data may be
preferred in order to inform the model. However, earlier observer data
may be less reliable, e.g., if observer training on seabird
identification and monitoring for seabird captures was less robust in
earlier years. Furthermore, population sizes of the birds being caught
will have changed over time.</p>
<p><code>fishing_years_fit</code> defines the years from which observer
data are used to estimate catchabilities. This is saved as part of the
data preparation process. In our example, we use all available observer
data:</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fishing_years_fit</span> <span class="op">&lt;-</span> <span class="fl">2020</span><span class="op">:</span><span class="fl">2021</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">fishing_years_fit</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_data</span>, <span class="st">"fishing_years_fit.rda"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The observer data are then filtered to keep data from the appropriate
time period:</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_effort</span>   <span class="op">&lt;-</span> <span class="va">obs_effort</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">fishing_years_fit</span><span class="op">)</span></span>
<span><span class="va">obs_captures</span> <span class="op">&lt;-</span> <span class="va">obs_captures</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">fishing_years_fit</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="combine-observed-effort-with-capture-data">Combine observed effort with capture data<a class="anchor" aria-label="anchor" href="#combine-observed-effort-with-capture-data"></a>
</h3>
<p>Get total observed effort and captures, which will be used to check
that total captures have been preserved:</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N_EFFORT</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obs_effort</span><span class="op">$</span><span class="va">observer_effort</span><span class="op">)</span></span>
<span><span class="va">N_CAPTURES</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obs_captures</span><span class="op">$</span><span class="va">n_captures</span><span class="op">)</span></span></code></pre></div>
<p>Add the (numeric) code ID (<code>id_code</code>) to the capture
data:</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_captures</span> <span class="op">&lt;-</span> <span class="va">sp_groups</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">code</span>, <span class="va">id_code</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">obs_captures</span>, <span class="va">.</span>, by <span class="op">=</span> <span class="st">"code"</span><span class="op">)</span></span></code></pre></div>
<p>Check for observed captures of species codes not included in the risk
assessment model:</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CHK_CAPTURES</span> <span class="op">&lt;-</span> <span class="va">obs_captures</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">sp_groups</span>, by <span class="op">=</span> <span class="st">"code"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Observed captures of species codes not included in the risk assessment model account for "</span>, <span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">CHK_CAPTURES</span><span class="op">$</span><span class="va">n_captures</span><span class="op">)</span><span class="op">/</span><span class="va">N_CAPTURES</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"% of total observed seabird captures"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Observed captures of species codes not included in the risk assessment model account for 100% of total observed seabird captures</span></span></code></pre>
<p>Restructure the captures data to have one record per strata:</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_captures</span> <span class="op">&lt;-</span> <span class="va">obs_captures</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by_all.html" class="external-link">group_by_at</a></span><span class="op">(</span><span class="va">strata_vars</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">code</span><span class="op">)</span>,</span>
<span>            id_code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">id_code</span><span class="op">)</span>,</span>
<span>            captures_status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">status</span><span class="op">)</span>,</span>
<span>            age_class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">age_class</span><span class="op">)</span>,</span>
<span>            n_captures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">n_captures</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre></div>
<p>Combine observed effort and captures, and check that total observed
effort and captures have been preserved:</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_data</span> <span class="op">&lt;-</span> <span class="va">obs_effort</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">obs_captures</span>, by <span class="op">=</span> <span class="va">strata_vars</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obs_data</span><span class="op">$</span><span class="va">observer_effort</span><span class="op">)</span>, <span class="va">N_EFFORT</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">obs_data</span><span class="op">$</span><span class="va">n_captures</span><span class="op">)</span><span class="op">)</span>, <span class="va">N_CAPTURES</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Add a unique identifier to each record in <code>obs_data</code>
called <code>record_id</code>:</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_data</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">.</span>, record_id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">obs_data</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">record_id</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The combined observer dataset has the following structure:</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="3%">
<col width="1%">
<col width="2%">
<col width="1%">
<col width="2%">
<col width="1%">
<col width="2%">
<col width="5%">
<col width="14%">
<col width="9%">
<col width="19%">
<col width="26%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="right">record_id</th>
<th align="left">flag</th>
<th align="left">target</th>
<th align="right">year</th>
<th align="right">month</th>
<th align="right">lon</th>
<th align="right">lat</th>
<th align="right">observer_effort</th>
<th align="left">code</th>
<th align="left">id_code</th>
<th align="left">captures_status</th>
<th align="left">age_class</th>
<th align="left">n_captures</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">NZL</td>
<td align="left">BET+YFT</td>
<td align="right">2020</td>
<td align="right">1</td>
<td align="right">72.5</td>
<td align="right">-32.5</td>
<td align="right">100</td>
<td align="left">NULL</td>
<td align="left">NULL</td>
<td align="left">NULL</td>
<td align="left">NULL</td>
<td align="left">NULL</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">NZL</td>
<td align="left">ALB</td>
<td align="right">2020</td>
<td align="right">4</td>
<td align="right">77.5</td>
<td align="right">-32.5</td>
<td align="right">130</td>
<td align="left">DIW, DIW, DIW, DIW, DIW, DIW, DIZ, BLZ</td>
<td align="left">1, 1, 1, 1, 1, 1, 34, 40</td>
<td align="left">alive, alive, dead , NA , alive, alive, alive,
dead</td>
<td align="left">adult , immature, NA , NA , adult , NA , adult ,
NA</td>
<td align="left">2, 1, 1, 1, 1, 2, 1, 1</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">NZL</td>
<td align="left">ALB</td>
<td align="right">2020</td>
<td align="right">7</td>
<td align="right">82.5</td>
<td align="right">-32.5</td>
<td align="right">160</td>
<td align="left">DCU, DCU, TWD, TWD, TWD, THZ, THZ</td>
<td align="left">12, 12, 13, 13, 13, 35, 35</td>
<td align="left">alive, alive, dead , dead , NA , alive, alive</td>
<td align="left">adult , immature, adult , immature, NA , juvenile,
NA</td>
<td align="left">5, 1, 2, 1, 1, 1, 2</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">NZL</td>
<td align="left">BET+YFT</td>
<td align="right">2020</td>
<td align="right">10</td>
<td align="right">87.5</td>
<td align="right">-32.5</td>
<td align="right">190</td>
<td align="left">NULL</td>
<td align="left">NULL</td>
<td align="left">NULL</td>
<td align="left">NULL</td>
<td align="left">NULL</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">NZL</td>
<td align="left">BET+YFT</td>
<td align="right">2021</td>
<td align="right">1</td>
<td align="right">72.5</td>
<td align="right">-27.5</td>
<td align="right">200</td>
<td align="left">PCN, PCN, PCN, PCN, PTZ</td>
<td align="left">25, 25, 25, 25, 37</td>
<td align="left">alive, dead , dead , NA , alive</td>
<td align="left">NA , immature, juvenile, NA , adult</td>
<td align="left">1, 11, 1, 1, 2</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">NZL</td>
<td align="left">ALB</td>
<td align="right">2021</td>
<td align="right">4</td>
<td align="right">77.5</td>
<td align="right">-27.5</td>
<td align="right">230</td>
<td align="left">NULL</td>
<td align="left">NULL</td>
<td align="left">NULL</td>
<td align="left">NULL</td>
<td align="left">NULL</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="left">NZL</td>
<td align="left">ALB</td>
<td align="right">2021</td>
<td align="right">7</td>
<td align="right">82.5</td>
<td align="right">-27.5</td>
<td align="right">260</td>
<td align="left">NULL</td>
<td align="left">NULL</td>
<td align="left">NULL</td>
<td align="left">NULL</td>
<td align="left">NULL</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="left">NZL</td>
<td align="left">BET+YFT</td>
<td align="right">2021</td>
<td align="right">10</td>
<td align="right">87.5</td>
<td align="right">-27.5</td>
<td align="right">290</td>
<td align="left">PRO, PRO, PRO, PRO, PCN, PCN, PRX</td>
<td align="left">24, 24, 24, 24, 25, 25, 39</td>
<td align="left">alive, alive, dead , dead , dead , dead , alive</td>
<td align="left">adult , juvenile, adult , NA , adult , immature,
adult</td>
<td align="left">2, 1, 9, 1, 9, 2, 2</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="assign-fishery-group-ids">Assign fishery group IDs<a class="anchor" aria-label="anchor" href="#assign-fishery-group-ids"></a>
</h3>
<p>It is necessary to assign ‘fishery groups’ to the observed effort and
capture data. Catchabilities are estimated with a fishery group specific
parameter, such that different fishery groups are more, or less, likely
to capture seabirds, all else being equal. However, all observed effort
could be represented by a single fishery group.</p>
<p>The function <code>assign_fishery_groups</code> assigns fishery
groups, defined as any combination of variables in the argument
<code>lk_definitions</code>. The variables defining fishery groups must
be present in both the observer dataset and the dataset of total effort
used to estimate total captures.</p>
<p>In this example, we define fishing groups based on target
species.</p>
<p>First, create a look-up table called <code>lk_fishery_groups</code>
that provides a name for each fishery group (the
<code>fishery_group</code> variable):</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lk_fishery_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id_fishery_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">2L</span><span class="op">)</span>, fishery_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Albacore"</span>, <span class="st">"Tropical Tuna"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">lk_fishery_groups</span><span class="op">$</span><span class="va">id_fishery_group</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">is.integer</a></span><span class="op">(</span><span class="va">lk_fishery_groups</span><span class="op">$</span><span class="va">id_fishery_group</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="va">latex_special_characters</span>, <span class="va">lk_fishery_groups</span><span class="op">$</span><span class="va">fishery_group</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="va">punctuation_characters</span>, <span class="va">lk_fishery_groups</span><span class="op">$</span><span class="va">fishery_group</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><code>id_fishery_group</code> must be an integer.
<code>fishery_group</code> names can have spaces, but should not have
punctuation characters, or special characters in LaTeX, e.g. underscores
(_), ampersands (&amp;), dollar signs ($) etc.</p>
<p>Then create a data frame called
<code>fishery_group_definitions</code> that defines fishery groups, in
this case based on target species:</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fishery_group_definitions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id_fishery_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">2L</span><span class="op">)</span>, target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ALB"</span>, <span class="st">"BET+YFT"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">fishery_group_definitions</span><span class="op">$</span><span class="va">id_fishery_group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">lk_fishery_groups</span><span class="op">$</span><span class="va">id_fishery_group</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The look-up table of fishery group names in this example
(<code>lk_fishery_groups</code>) is:</p>
<table class="table">
<thead><tr class="header">
<th align="right">id_fishery_group</th>
<th align="left">fishery_group</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Albacore</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Tropical Tuna</td>
</tr>
</tbody>
</table>
<p>and the data frame defining the fishery groups
(<code>fishery_group_definitions</code>) is:</p>
<table class="table">
<thead><tr class="header">
<th align="right">id_fishery_group</th>
<th align="left">target</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">ALB</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">BET+YFT</td>
</tr>
</tbody>
</table>
<p>Assign fishery groups to <code>obs_data</code> using
<code>assign_fishery_groups</code>:</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assign_fishery_groups.html">assign_fishery_groups</a></span><span class="op">(</span><span class="va">obs_data</span>, lk_definitions <span class="op">=</span> <span class="va">fishery_group_definitions</span>, lk_names <span class="op">=</span> <span class="va">lk_fishery_groups</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(target)`</span></span></code></pre>
<p>As mentioned above, the User can choose to include all surface
longline effort in a single fishery group. E.g., for observed effort of
Japanese vessels, a single fishery group could be applied with:</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lk_fishery_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id_fishery_group <span class="op">=</span> <span class="fl">1L</span>, fishery_group <span class="op">=</span> <span class="st">"All"</span><span class="op">)</span></span>
<span><span class="va">fishery_group_definitions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id_fishery_group <span class="op">=</span> <span class="fl">1L</span>, flag <span class="op">=</span> <span class="st">"JPN"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">obs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assign_fishery_groups.html">assign_fishery_groups</a></span><span class="op">(</span><span class="va">obs_data</span>, lk_definitions <span class="op">=</span> <span class="va">fishery_group_definitions</span>, lk_names <span class="op">=</span> <span class="va">lk_fishery_groups</span><span class="op">)</span></span></code></pre></div>
<p>Check for observer data with no assigned fishery group:</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CHK_EFFORT</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">id_fishery_group</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">observer_effort</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">CHK_CAPTURES</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">id_fishery_group</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">n_captures</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Observed effort with an assigned fishery group accounts for "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="va">CHK_EFFORT</span><span class="op">/</span><span class="va">N_EFFORT</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"% of total observed effort\n"</span>,</span>
<span>       <span class="st">"(and "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="va">CHK_CAPTURES</span><span class="op">/</span><span class="va">N_CAPTURES</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"% of total observed seabird captures)"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Observed effort with an assigned fishery group accounts for 100% of total observed effort</span></span>
<span><span class="co">## (and 100% of total observed seabird captures)</span></span></code></pre>
<p>Then save <code>fishery_group_definitions</code> and
<code>lk_fishery_groups</code> so that fishery groups can be assigned to
the total effort data (for the User’s longline fleet):</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">lk_fishery_groups</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_data</span>, <span class="st">"lk_fishery_groups.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">fishery_group_definitions</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_data</span>, <span class="st">"fishery_group_definitions.rda"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="assign-time-periods-for-catchabilities">Assign time periods for catchabilities<a class="anchor" aria-label="anchor" href="#assign-time-periods-for-catchabilities"></a>
</h3>
<p>Catchabilities can be estimated with time-varying catchabilities,
e.g., to reflect changes in seabird bycatch mitigation measures through
time. Similarly to fishery groups, the full time series of observer
could be considered as a single time period. The function
<code>assign_time_periods</code> assigns the periods of time in which
catchabilities are shared.</p>
<p>Here, for example purposes, we define separate time periods for 2020
and 2021.</p>
<p>Create a look-up table called <code>lk_time_periods</code> that
provides a name for each time period (the <code>period</code>
variable):</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lk_time_periods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id_period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">2L</span><span class="op">)</span>, period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"early"</span>, <span class="st">"late"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">lk_time_periods</span><span class="op">$</span><span class="va">id_period</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">is.integer</a></span><span class="op">(</span><span class="va">lk_time_periods</span><span class="op">$</span><span class="va">id_period</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="va">latex_special_characters</span>, <span class="va">lk_time_periods</span><span class="op">$</span><span class="va">period</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="va">punctuation_characters</span>, <span class="va">lk_time_periods</span><span class="op">$</span><span class="va">period</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><code>id_period</code> must be an integer. <code>period</code> names
can have spaces, but should not have punctuation characters, or special
characters in LaTeX, e.g. underscores (_), ampersands (&amp;), dollar
signs ($) etc.</p>
<p>Then, create a data frame called <code>time_period_definitions</code>
that defines separate time periods for each year:</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">time_period_definitions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id_period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">2L</span><span class="op">)</span>, year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2020L</span>, <span class="fl">2021L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">time_period_definitions</span><span class="op">$</span><span class="va">id_period</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">lk_time_periods</span><span class="op">$</span><span class="va">id_period</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The look-up table of time period names in this example
(<code>lk_time_periods</code>) is:</p>
<table class="table">
<thead><tr class="header">
<th align="right">id_period</th>
<th align="left">period</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">early</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">late</td>
</tr>
</tbody>
</table>
<p>and the data frame defining the time periods
(<code>time_period_definitions</code>) is:</p>
<table class="table">
<thead><tr class="header">
<th align="right">id_period</th>
<th align="right">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">2020</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2021</td>
</tr>
</tbody>
</table>
<p>Now assign time periods to <code>obs_data</code> using
<code>assign_time_period</code>:</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assign_time_periods.html">assign_time_periods</a></span><span class="op">(</span><span class="va">obs_data</span>, lk_definitions <span class="op">=</span> <span class="va">time_period_definitions</span>, lk_names <span class="op">=</span> <span class="va">lk_time_periods</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(year)`</span></span></code></pre>
<p>Check for observer data with no assigned time period:</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CHK_EFFORT</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">id_period</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">observer_effort</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">CHK_CAPTURES</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">id_period</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">n_captures</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Observed effort with an assigned time period accounts for "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="va">CHK_EFFORT</span><span class="op">/</span><span class="va">N_EFFORT</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"% of total observed effort\n"</span>,</span>
<span>       <span class="st">"(and "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="va">CHK_CAPTURES</span><span class="op">/</span><span class="va">N_CAPTURES</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"% of total observed seabird captures)"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Observed effort with an assigned time period accounts for 100% of total observed effort</span></span>
<span><span class="co">## (and 100% of total observed seabird captures)</span></span></code></pre>
<p>Then save <code>time_period_definitions</code> and
<code>lk_time_periods</code> so that time periods can be assigned to the
total effort dataset (for the User’s longline fleet):</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">lk_time_periods</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_data</span>, <span class="st">"lk_time_periods.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">time_period_definitions</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_data</span>, <span class="st">"time_period_definitions.rda"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="remove-records-missing-required-information">Remove records missing required information<a class="anchor" aria-label="anchor" href="#remove-records-missing-required-information"></a>
</h3>
<p>Remove records missing required information to get observed density
overlap with seabird distributions:</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_data</span>  <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lat</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lon</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CHK_EFFORT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obs_data</span><span class="op">$</span><span class="va">observer_effort</span><span class="op">)</span></span>
<span><span class="va">CHK_CAPTURES</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">obs_data</span><span class="op">$</span><span class="va">n_captures</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Observed effort with required location and month information accounts for "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="va">CHK_EFFORT</span><span class="op">/</span><span class="va">N_EFFORT</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"% of total observed effort\n"</span>, <span class="st">"(and "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="va">CHK_CAPTURES</span><span class="op">/</span><span class="va">N_CAPTURES</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"% of total observed seabird captures)"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Observed effort with required location and month information accounts for 100% of total observed effort</span></span>
<span><span class="co">## (and 100% of total observed seabird captures)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="format-obs_data-for-calculation-of-density-overlap">Format <code>obs_data</code> for calculation of density overlap<a class="anchor" aria-label="anchor" href="#format-obs_data-for-calculation-of-density-overlap"></a>
</h3>
<p>First, convert <code>month</code> to give the abbreviated month name,
keeping month as an integer in a new field called
<code>month_id</code>:</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_data</span><span class="op">$</span><span class="va">id_month</span> <span class="op">&lt;-</span> <span class="va">obs_data</span><span class="op">$</span><span class="va">month</span></span>
<span><span class="va">obs_data</span><span class="op">$</span><span class="va">month</span> <span class="op">&lt;-</span> <span class="va">month.abb</span><span class="op">[</span><span class="va">obs_data</span><span class="op">$</span><span class="va">month</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">obs_data</span><span class="op">$</span><span class="va">month</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The <code>month</code> variable is used to get the seabird density
map for the correct month for each record in <code>obs_data</code>.</p>
<p>The synthetic observer data are provided at a 5 degree resolution
(matching the spatial resolution of the seabird density maps), with the
provided latitude / longitude positions giving the mid-point of the 5
degree cell.</p>
<p>As described above, it is necessary for <code>obs_data</code> to be a
<code>sf</code> object, with the correct coordinate reference system, to
allow the calculation of overlap between fishing effort and seabird
distributions. The spatial information should be included in a variable
named <code>geometry</code>.</p>
<p>Reformat <code>obs_data</code> to be a <code>sf</code> object, with
the <code>geometry</code> variable representing the location of fishing
effort (provided as lat/lons):</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_data</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">.</span>, geometry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">.</span>, crs <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span></span></code></pre></div>
<p>The coordinate reference system of <code>obs_data</code> must be
transformed to that of <code>grid</code> to ensure a consistent
coordinate reference system with the seabird density maps:</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_data</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>It is important to note that, when preparing your own data, the
location of fishing effort does not necessarily need to be represented
as a point. For example, polygons could be used for aggregated effort
data. The most appropriate approach for the User will depend on their
data structure, e.g., midpoints of cells or polygons are appropriate for
data aggregated to a 1x1 or 5x5 resolution, whereas set locations can be
used for set-level observer data.</p>
<p>Add unique cell identifiers from <code>grid</code> to
<code>obs_data</code>, to allow for model diagnostics with a spatial
dimension:</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_id_cell.html">get_id_cell</a></span><span class="op">(</span><span class="va">obs_data</span>, fun <span class="op">=</span> <span class="va">min</span><span class="op">)</span></span></code></pre></div>
<p>Points that fall on a boundary between multiple 5 degree cells
(i.e. a boundary or intersection between polygons in <code>grid</code>)
are assigned the lowest <code>id_cell</code> from matching cells with
<code>fun = min</code> in <code>get_id_cell</code> calls. Note that
<code>get_overlap</code> uses the mean density across the appropriate
cells, for points on a boundary or intersection between multiple 5
degree cells.</p>
<p>The observer data have the following structure:</p>
<pre><code><span><span class="co">## sf [8 × 18] (S3: sf/tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##  $ record_id       : int [1:8] 1 2 3 4 5 6 7 8</span></span>
<span><span class="co">##  $ flag            : chr [1:8] "NZL" "NZL" "NZL" "NZL" ...</span></span>
<span><span class="co">##  $ target          : chr [1:8] "BET+YFT" "ALB" "ALB" "BET+YFT" ...</span></span>
<span><span class="co">##  $ year            : int [1:8] 2020 2020 2020 2020 2021 2021 2021 2021</span></span>
<span><span class="co">##  $ month           : chr [1:8] "Jan" "Apr" "Jul" "Oct" ...</span></span>
<span><span class="co">##  $ lon             : num [1:8] 72.5 77.5 82.5 87.5 72.5 77.5 82.5 87.5</span></span>
<span><span class="co">##  $ lat             : num [1:8] -32.5 -32.5 -32.5 -32.5 -27.5 -27.5 -27.5 -27.5</span></span>
<span><span class="co">##  $ observer_effort : int [1:8] 100 130 160 190 200 230 260 290</span></span>
<span><span class="co">##  $ code            :List of 8</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : chr [1:8] "DIW" "DIW" "DIW" "DIW" ...</span></span>
<span><span class="co">##   ..$ : chr [1:7] "DCU" "DCU" "TWD" "TWD" ...</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : chr [1:5] "PCN" "PCN" "PCN" "PCN" ...</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : chr [1:7] "PRO" "PRO" "PRO" "PRO" ...</span></span>
<span><span class="co">##  $ id_code         :List of 8</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : int [1:8] 1 1 1 1 1 1 34 40</span></span>
<span><span class="co">##   ..$ : int [1:7] 12 12 13 13 13 35 35</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : int [1:5] 25 25 25 25 37</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : int [1:7] 24 24 24 24 25 25 39</span></span>
<span><span class="co">##  $ captures_status :List of 8</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : chr [1:8] "alive" "alive" "dead" NA ...</span></span>
<span><span class="co">##   ..$ : chr [1:7] "alive" "alive" "dead" "dead" ...</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : chr [1:5] "alive" "dead" "dead" NA ...</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : chr [1:7] "alive" "alive" "dead" "dead" ...</span></span>
<span><span class="co">##  $ age_class       :List of 8</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : chr [1:8] "adult" "immature" NA NA ...</span></span>
<span><span class="co">##   ..$ : chr [1:7] "adult" "immature" "adult" "immature" ...</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : chr [1:5] NA "immature" "juvenile" NA ...</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : chr [1:7] "adult" "juvenile" "adult" NA ...</span></span>
<span><span class="co">##  $ n_captures      :List of 8</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : int [1:8] 2 1 1 1 1 2 1 1</span></span>
<span><span class="co">##   ..$ : int [1:7] 5 1 2 1 1 1 2</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : int [1:5] 1 11 1 1 2</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : int [1:7] 2 1 9 1 9 2 2</span></span>
<span><span class="co">##  $ id_fishery_group: int [1:8] 2 1 1 2 2 1 1 2</span></span>
<span><span class="co">##  $ id_period       : int [1:8] 1 1 1 1 2 2 2 2</span></span>
<span><span class="co">##  $ id_month        : int [1:8] 1 4 7 10 1 4 7 10</span></span>
<span><span class="co">##  $ geometry        :sfc_POINT of length 8; first list element:  'XY' num [1:2] -6087560 -801442</span></span>
<span><span class="co">##  $ id_cell         : int [1:8] 771 772 773 774 843 844 845 846</span></span>
<span><span class="co">##  - attr(*, "sf_column")= chr "geometry"</span></span>
<span><span class="co">##  - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr [1:17] "record_id" "flag" "target" "year" ...</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="generate-data-inputs-for-the-risk-assessment-model">Generate data inputs for the risk assessment model<a class="anchor" aria-label="anchor" href="#generate-data-inputs-for-the-risk-assessment-model"></a>
</h2>
<div class="section level3">
<h3 id="calculate-density-overlap-of-observed-fishing-effort-with-seabird-distributions">Calculate density overlap of observed fishing effort with seabird
distributions<a class="anchor" aria-label="anchor" href="#calculate-density-overlap-of-observed-fishing-effort-with-seabird-distributions"></a>
</h3>
<p>Calculate density overlap by species:</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_overlap</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">record_id</span>, <span class="va">flag</span>, <span class="va">year</span>, <span class="va">id_period</span>, <span class="va">id_month</span>, <span class="va">month</span>, <span class="va">id_fishery_group</span>, <span class="va">id_cell</span>, <span class="va">observer_effort</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">spp</span> <span class="kw">in</span> <span class="va">species</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">obs_overlap</span> <span class="op">&lt;-</span> <span class="va">obs_overlap</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/get_overlap.html">get_overlap</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">spp</span>, effort_name <span class="op">=</span> <span class="st">"observer_effort"</span>, group_name <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Finished with spatial information in <code>obs_overlap</code>, so
remove spatial information:</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_overlap</span> <span class="op">&lt;-</span> <span class="va">obs_overlap</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">obs_data</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">obs_overlap</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="aggregate-observed-density-overlap">Aggregate observed density overlap<a class="anchor" aria-label="anchor" href="#aggregate-observed-density-overlap"></a>
</h3>
<p>Create object <code>overlap_o</code> with aggregated observed overlap
for model fitting:</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Record for checking</span></span>
<span><span class="va">OVERLAP_O</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obs_overlap</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^overlap_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">obs_overlap</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate data frame with aggregated observed overlap by species</span></span>
<span><span class="va">overlap_o</span> <span class="op">&lt;-</span> <span class="va">obs_overlap</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/aggregate_overlap.html">aggregate_overlap</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">id_fishery_group</span>, <span class="va">year</span>, <span class="va">id_period</span>, <span class="va">id_month</span>, <span class="va">month</span>, <span class="va">id_cell</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add species groups and taxonomic information</span></span>
<span><span class="va">overlap_o</span> <span class="op">&lt;-</span> <span class="va">sp_groups</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">code</span>, <span class="va">id_code</span>, <span class="va">id_species_group</span>, <span class="va">id_species</span>, <span class="va">id_genus</span>, <span class="va">id_family</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">overlap_o</span>, <span class="va">.</span>, by <span class="op">=</span> <span class="st">"code"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># And reformat variables</span></span>
<span><span class="va">overlap_o</span> <span class="op">&lt;-</span> <span class="va">overlap_o</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id_month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">id_month</span><span class="op">)</span>,</span>
<span>         id_period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">id_period</span><span class="op">)</span>,</span>
<span>         id_fishery_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">id_fishery_group</span><span class="op">)</span>,</span>
<span>         id_cell <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">id_cell</span><span class="op">)</span>,</span>
<span>         id_code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">id_code</span><span class="op">)</span>,</span>
<span>         id_species_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">id_species_group</span><span class="op">)</span>,</span>
<span>         id_species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">id_species</span><span class="op">)</span>,</span>
<span>         id_genus <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">id_genus</span><span class="op">)</span>,</span>
<span>         id_family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">id_family</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reorder variables</span></span>
<span><span class="va">overlap_o</span> <span class="op">&lt;-</span> <span class="va">overlap_o</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">id_fishery_group</span>, <span class="va">year</span>, <span class="va">id_period</span>, <span class="va">id_month</span>, <span class="va">month</span>, <span class="va">id_cell</span>,</span>
<span>                <span class="va">code</span>, <span class="va">id_code</span>, <span class="va">id_species_group</span>, <span class="va">id_species</span>, <span class="va">id_genus</span>, <span class="va">id_family</span>, <span class="va">overlap</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check no NA values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">overlap_o</span><span class="op">$</span><span class="va">overlap</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check overlap</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">OVERLAP_O</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">overlap_o</span><span class="op">$</span><span class="va">overlap</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The structure of <code>overlap_o</code> is:</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">overlap_o</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## tibble [200 × 14] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##  $ flag            : chr [1:200] "NZL" "NZL" "NZL" "NZL" ...</span></span>
<span><span class="co">##  $ id_fishery_group: int [1:200] 1 1 1 1 2 2 2 2 1 1 ...</span></span>
<span><span class="co">##  $ year            : int [1:200] 2020 2020 2021 2021 2020 2020 2021 2021 2020 2020 ...</span></span>
<span><span class="co">##  $ id_period       : int [1:200] 1 1 2 2 1 1 2 2 1 1 ...</span></span>
<span><span class="co">##  $ id_month        : int [1:200] 4 7 4 7 1 10 1 10 4 7 ...</span></span>
<span><span class="co">##  $ month           : chr [1:200] "Apr" "Jul" "Apr" "Jul" ...</span></span>
<span><span class="co">##  $ id_cell         : int [1:200] 772 773 844 845 771 774 843 846 772 773 ...</span></span>
<span><span class="co">##  $ code            : chr [1:200] "DAM" "DAM" "DAM" "DAM" ...</span></span>
<span><span class="co">##  $ id_code         : int [1:200] 5 5 5 5 5 5 5 5 4 4 ...</span></span>
<span><span class="co">##  $ id_species_group: int [1:200] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ id_species      : int [1:200] 5 5 5 5 5 5 5 5 4 4 ...</span></span>
<span><span class="co">##  $ id_genus        : int [1:200] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ id_family       : int [1:200] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ overlap         : num [1:200] 1.88e-05 1.70e-05 1.53e-05 1.41e-05 1.47e-05 ...</span></span></code></pre>
<p><code>overlap_o</code> has a finer stratification than the resolution
of the risk assessment model. This allows for more detailed diagnostics
of the model fits to observed captures, both temporally and
spatially.</p>
</div>
<div class="section level3">
<h3 id="aggregate-observed-captures-to-resolution-of-the-risk-assessment-model">Aggregate observed captures to resolution of the risk assessment
model<a class="anchor" aria-label="anchor" href="#aggregate-observed-captures-to-resolution-of-the-risk-assessment-model"></a>
</h3>
<p>Get captures by ‘species code’, including individuals not identified
to a species-level:</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a named vector of all codes (used in aggregate_captures call)</span></span>
<span><span class="va">named_sp_codes</span> <span class="op">&lt;-</span> <span class="va">sp_groups</span><span class="op">[</span>, <span class="st">"code"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">named_sp_codes</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">named_sp_codes</span></span>
<span></span>
<span><span class="va">captures_all</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/aggregate_captures.html">aggregate_captures</a></span><span class="op">(</span>strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flag"</span>, <span class="st">"id_fishery_group"</span>, <span class="st">"year"</span>, <span class="st">"id_period"</span>, <span class="st">"id_month"</span>, <span class="st">"month"</span>, <span class="st">"id_cell"</span><span class="op">)</span>, <span class="va">named_sp_codes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">.</span>, code <span class="op">=</span> <span class="va">group</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check no captures lost</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">captures_all</span><span class="op">$</span><span class="va">n_captures</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">obs_data</span><span class="op">$</span><span class="va">n_captures</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">obs_data</span><span class="op">$</span><span class="va">code</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sp_groups</span><span class="op">$</span><span class="va">code</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Get captures by status (alive / dead):</p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">captures_alive</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter_captures.html">filter_captures</a></span><span class="op">(</span><span class="va">.</span>, field <span class="op">=</span> <span class="st">"captures_status"</span>, condition <span class="op">=</span> <span class="st">"alive"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/aggregate_captures.html">aggregate_captures</a></span><span class="op">(</span><span class="va">.</span>, strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flag"</span>, <span class="st">"id_fishery_group"</span>, <span class="st">"year"</span>, <span class="st">"id_period"</span>, <span class="st">"id_month"</span>, <span class="st">"id_cell"</span><span class="op">)</span>, <span class="va">named_sp_codes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">.</span>, code <span class="op">=</span> <span class="va">group</span><span class="op">)</span></span>
<span></span>
<span><span class="va">captures_dead</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter_captures.html">filter_captures</a></span><span class="op">(</span><span class="va">.</span>, field <span class="op">=</span> <span class="st">"captures_status"</span>, condition <span class="op">=</span> <span class="st">"dead"</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/aggregate_captures.html">aggregate_captures</a></span><span class="op">(</span><span class="va">.</span>, strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flag"</span>, <span class="st">"id_fishery_group"</span>, <span class="st">"year"</span>, <span class="st">"id_period"</span>, <span class="st">"id_month"</span>, <span class="st">"id_cell"</span><span class="op">)</span>, <span class="va">named_sp_codes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">.</span>, code <span class="op">=</span> <span class="va">group</span><span class="op">)</span></span>
<span></span>
<span><span class="va">captures_status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span></span>
<span>  <span class="va">captures_alive</span>, <span class="va">captures_dead</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flag"</span>, <span class="st">"id_fishery_group"</span>, <span class="st">"year"</span>, <span class="st">"id_period"</span>, <span class="st">"id_month"</span>, <span class="st">"id_cell"</span>, <span class="st">"code"</span><span class="op">)</span>,</span>
<span>  suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"_alive"</span>, <span class="st">"_dead"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># report captures without usable status information</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Captures without usable status information (i.e. not 'alive' or 'dead') = "</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">captures_all</span><span class="op">$</span><span class="va">n_captures</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">captures_status</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n_captures_alive"</span>, <span class="st">"n_captures_dead"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Captures without usable status information (i.e. not 'alive' or 'dead') = 3</span></span></code></pre>
<p>Combine observed captures data to include total individuals, and
individuals by status:</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">captures_o</span> <span class="op">&lt;-</span> <span class="va">sp_groups</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">id_code</span>, <span class="va">id_species_group</span>, <span class="va">id_species</span>, <span class="va">id_genus</span>, <span class="va">id_family</span>, <span class="va">code</span>, <span class="va">taxonomic_resolution</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">captures_all</span>, by <span class="op">=</span> <span class="st">"code"</span>, relationship <span class="op">=</span> <span class="st">"one-to-many"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">captures_status</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flag"</span>, <span class="st">"id_fishery_group"</span>, <span class="st">"year"</span>, <span class="st">"id_period"</span>, <span class="st">"id_month"</span>, <span class="st">"id_cell"</span>, <span class="st">"code"</span><span class="op">)</span>, relationship <span class="op">=</span> <span class="st">"one-to-one"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">captures_o</span> <span class="op">&lt;-</span> <span class="va">captures_o</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">id_fishery_group</span>, <span class="va">year</span>, <span class="va">id_period</span>, <span class="va">id_month</span>, <span class="va">month</span>, <span class="va">id_cell</span>,</span>
<span>                                    <span class="va">code</span>, <span class="va">id_code</span>, <span class="va">id_species_group</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">captures_all</span><span class="op">$</span><span class="va">n_captures</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">captures_o</span><span class="op">$</span><span class="va">n_captures</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For taxonomic ID fields in <code>captures_o</code>, replace
<code>NA</code>s with -1’s:</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id_species"</span>, <span class="st">"id_species_group"</span>, <span class="st">"id_genus"</span>, <span class="st">"id_family"</span><span class="op">)</span></span>
<span><span class="va">captures_o</span><span class="op">[</span>, <span class="va">id_vars</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">captures_o</span><span class="op">[</span>, <span class="va">id_vars</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1L</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>The structure of <code>captures_o</code> is:</p>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">captures_o</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    320 obs. of  17 variables:</span></span>
<span><span class="co">##  $ flag                : chr  "NZL" "NZL" "NZL" "NZL" ...</span></span>
<span><span class="co">##  $ id_fishery_group    : int  1 1 1 1 2 2 2 2 1 1 ...</span></span>
<span><span class="co">##  $ year                : int  2020 2020 2021 2021 2020 2020 2021 2021 2020 2020 ...</span></span>
<span><span class="co">##  $ id_period           : int  1 1 2 2 1 1 2 2 1 1 ...</span></span>
<span><span class="co">##  $ id_month            : int  4 7 4 7 1 10 1 10 4 7 ...</span></span>
<span><span class="co">##  $ month               : chr  "Apr" "Jul" "Apr" "Jul" ...</span></span>
<span><span class="co">##  $ id_cell             : int  772 773 844 845 771 774 843 846 772 773 ...</span></span>
<span><span class="co">##  $ code                : chr  "DIW" "DIW" "DIW" "DIW" ...</span></span>
<span><span class="co">##  $ id_code             : int  1 1 1 1 1 1 1 1 2 2 ...</span></span>
<span><span class="co">##  $ id_species_group    : num  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ id_species          : int  1 1 1 1 1 1 1 1 2 2 ...</span></span>
<span><span class="co">##  $ id_genus            : num  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ id_family           : int  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ taxonomic_resolution: chr  "species" "species" "species" "species" ...</span></span>
<span><span class="co">##  $ n_captures          : int  8 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ n_captures_alive    : int  6 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ n_captures_dead     : int  1 0 0 0 0 0 0 0 0 0 ...</span></span></code></pre>
<p>Similarly to <code>overlap_o</code>, <code>captures_o</code> has a
finer stratification than the resolution of the risk assessment model.
This allows for more detailed diagnostics of the model fits to observed
captures, both temporally and spatially.</p>
</div>
</div>
<div class="section level2">
<h2 id="generate-tables-and-figures-summarising-prepared-data">Generate tables and figures summarising prepared data<a class="anchor" aria-label="anchor" href="#generate-tables-and-figures-summarising-prepared-data"></a>
</h2>
<p>Here, LaTeX tables and figures are generated which summarise the
prepared observer dataset. This facilitates generation of standardised
tables and figures for all collaborating CCSBT members that provide a
broad overview of the analysed datasets. Saving tables in LaTeX format
will facilitate composition of the final report. Tables are also saved
in binary format for ease of manipulation should alternative
presentations be required.</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tables_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_data</span>, <span class="st">"tables"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/make_folder.html">make_folder</a></span><span class="op">(</span><span class="va">tables_path</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## directory created</span></span></code></pre>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">figures_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_data</span>, <span class="st">"figures"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/make_folder.html">make_folder</a></span><span class="op">(</span><span class="va">figures_path</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## directory created</span></span></code></pre>
<p>Make a character string with flags, to use when creating table
captions etc.:</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flag_str</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">overlap_o</span><span class="op">$</span><span class="va">flag</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span></span>
<span><span class="va">flag_str_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">overlap_o</span><span class="op">$</span><span class="va">flag</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="summary-tables-of-observed-effort">Summary tables of observed effort<a class="anchor" aria-label="anchor" href="#summary-tables-of-observed-effort"></a>
</h3>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Observed effort by year</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.</span>, observer_effort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">observer_effort</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Drop flag from object used to create kable object</span></span>
<span><span class="va">observed_effort</span> <span class="op">&lt;-</span> <span class="va">tab</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">-</span> <span class="va">flag</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Format numeric variables</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/numeric_table_format.html">numeric_table_format</a></span><span class="op">(</span><span class="va">.</span>, names <span class="op">=</span> <span class="st">"observer_effort"</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set column names for kable object</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_sentence</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">" "</span>, <span class="va">kbl_colnames</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># caption</span></span>
<span><span class="va">kbl_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Sum of observed fishing effort ('000 hooks) per year for "</span>, <span class="va">flag_str</span>, <span class="st">"."</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tab</span>, format <span class="op">=</span> <span class="st">'latex'</span>,</span>
<span>       col.names <span class="op">=</span> <span class="va">kbl_colnames</span>,</span>
<span>       row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       caption <span class="op">=</span> <span class="va">kbl_cap</span>,</span>
<span>       label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"observed_effort_by_year_"</span>, <span class="va">flag_str_label</span><span class="op">)</span>,</span>
<span>       align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="st">"r"</span><span class="op">)</span>,</span>
<span>       linesep <span class="op">=</span> <span class="st">""</span>, booktabs <span class="op">=</span> <span class="cn">TRUE</span>, escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">10</span>, latex_options <span class="op">=</span> <span class="st">"hold_position"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\toprule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\bottomrule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/save_kable.html" class="external-link">save_kable</a></span><span class="op">(</span><span class="va">tab</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_effort_by_year.tex"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">observed_effort</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_effort_by_year.rda"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">flag</th>
<th align="right">year</th>
<th align="right">observer_effort</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NZL</td>
<td align="right">2020</td>
<td align="right">580</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="right">2021</td>
<td align="right">980</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Observed effort by year and fishery group</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lk_fishery_groups</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">year</span>, <span class="va">id_fishery_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.</span>, observer_effort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">observer_effort</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">lk_fishery_groups</span>, by <span class="op">=</span> <span class="st">"id_fishery_group"</span><span class="op">)</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span><span class="va">.</span>, id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">flag</span>, <span class="va">year</span><span class="op">)</span>, names_from <span class="op">=</span> <span class="va">fishery_group</span>, values_from <span class="op">=</span> <span class="va">observer_effort</span>, values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Add a totals column</span></span>
<span>  <span class="va">tab</span><span class="op">$</span><span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flag"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Drop flag from object used to create kable object</span></span>
<span>  <span class="va">observed_effort_by_fgroup</span> <span class="op">&lt;-</span> <span class="va">tab</span>  </span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">-</span> <span class="va">flag</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Format numeric variables</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/numeric_table_format.html">numeric_table_format</a></span><span class="op">(</span><span class="va">.</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lk_fishery_groups</span><span class="op">$</span><span class="va">fishery_group</span>, <span class="st">"total"</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Set column names for kable object</span></span>
<span>  <span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_sentence</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># caption</span></span>
<span>  <span class="va">kbl_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Sum of observed effort ('000 hooks) by fishery group for "</span>, <span class="va">flag_str</span>, <span class="st">"."</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tab</span>, format <span class="op">=</span> <span class="st">'latex'</span>,</span>
<span>       col.names <span class="op">=</span> <span class="va">kbl_colnames</span>,</span>
<span>       row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       caption <span class="op">=</span> <span class="va">kbl_cap</span>,</span>
<span>       label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"observed_effort_by_fgroup"</span>, <span class="va">flag_str_label</span><span class="op">)</span>,</span>
<span>       align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"r"</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       linesep <span class="op">=</span> <span class="st">""</span>, booktabs <span class="op">=</span> <span class="cn">TRUE</span>, escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">10</span>, latex_options <span class="op">=</span> <span class="st">"hold_position"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\toprule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\bottomrule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/save_kable.html" class="external-link">save_kable</a></span><span class="op">(</span><span class="va">tab</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_effort_by_fgroup.tex"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">observed_effort_by_fgroup</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_effort_by_fgroup.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">flag</th>
<th align="right">year</th>
<th align="right">Albacore</th>
<th align="right">Tropical Tuna</th>
<th align="right">total</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NZL</td>
<td align="right">2020</td>
<td align="right">290</td>
<td align="right">290</td>
<td align="right">580</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="right">2021</td>
<td align="right">490</td>
<td align="right">490</td>
<td align="right">980</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="summary-tables-of-observed-captures-by-code">Summary tables of observed captures by code<a class="anchor" aria-label="anchor" href="#summary-tables-of-observed-captures-by-code"></a>
</h3>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Captures by species code (and capture status)</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">captures_o</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">code</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"captures"</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">sp_groups</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">code</span>, <span class="va">common_name</span>, <span class="va">taxonomic_resolution</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tab</span>, by <span class="op">=</span> <span class="st">"code"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">code</span>, <span class="va">common_name</span>, <span class="va">taxonomic_resolution</span>, <span class="va">n_captures</span>, <span class="va">n_captures_alive</span>, <span class="va">n_captures_dead</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Drop flag from object used to create kable object</span></span>
<span><span class="va">observed_captures_by_code</span> <span class="op">&lt;-</span> <span class="va">tab</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">-</span> <span class="va">flag</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Format numeric variables</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/numeric_table_format.html">numeric_table_format</a></span><span class="op">(</span><span class="va">.</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n_captures"</span>, <span class="st">"n_captures_alive"</span>, <span class="st">"n_captures_dead"</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## New names:</span></span>
<span><span class="co">## New names:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">•</span> `` -&gt; `...1`</span></span>
<span><span class="co">## <span style="color: #00BBBB;">•</span> `` -&gt; `...2`</span></span>
<span><span class="co">## <span style="color: #00BBBB;">•</span> `` -&gt; `...3`</span></span></code></pre>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set column names for kable object</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"n_captures$"</span>, <span class="st">"Total"</span>, <span class="va">kbl_colnames</span><span class="op">)</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"n_captures_"</span>, <span class="st">""</span>, <span class="va">kbl_colnames</span><span class="op">)</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_sentence</a></span><span class="op">(</span><span class="va">kbl_colnames</span><span class="op">)</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">" "</span>, <span class="va">kbl_colnames</span><span class="op">)</span></span>
<span></span>
<span><span class="va">kbl_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Sum of observed captures by code for "</span>, <span class="va">flag_str</span>, <span class="st">"."</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tab</span>, format <span class="op">=</span> <span class="st">'latex'</span>,</span>
<span>       col.names <span class="op">=</span> <span class="va">kbl_colnames</span>,</span>
<span>       row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       caption <span class="op">=</span> <span class="va">kbl_cap</span>,</span>
<span>       label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"observed_captures_by_code"</span>, <span class="va">flag_str_label</span><span class="op">)</span>,</span>
<span>       align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span><span class="op">)</span>,</span>
<span>       linesep <span class="op">=</span> <span class="st">""</span>, booktabs <span class="op">=</span> <span class="cn">TRUE</span>, escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">10</span>, latex_options <span class="op">=</span> <span class="st">"hold_position"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\toprule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\bottomrule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/save_kable.html" class="external-link">save_kable</a></span><span class="op">(</span><span class="va">tab</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_captures_by_code.tex"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">observed_captures_by_code</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_captures_by_code.rda"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="4%">
<col width="4%">
<col width="31%">
<col width="19%">
<col width="10%">
<col width="15%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left">flag</th>
<th align="left">code</th>
<th align="left">common_name</th>
<th align="left">taxonomic_resolution</th>
<th align="right">n_captures</th>
<th align="right">n_captures_alive</th>
<th align="right">n_captures_dead</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIW</td>
<td align="left">Gibson’s albatross</td>
<td align="left">species</td>
<td align="right">8</td>
<td align="right">6</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DQS</td>
<td align="left">Antipodean albatross</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIX</td>
<td align="left">Wandering albatross</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DBN</td>
<td align="left">Tristan albatross</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DAM</td>
<td align="left">Amsterdam albatross</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIP</td>
<td align="left">Southern royal albatross</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIQ</td>
<td align="left">Northern royal albatross</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DCR</td>
<td align="left">Atlantic yellow-nosed albatross</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TQH</td>
<td align="left">Indian yellow-nosed albatross</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIM</td>
<td align="left">Black-browed albatross</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TQW</td>
<td align="left">Campbell black-browed albatross</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DCU</td>
<td align="left">Shy albatross</td>
<td align="left">species</td>
<td align="right">6</td>
<td align="right">6</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TWD</td>
<td align="left">New Zealand white-capped albatross</td>
<td align="left">species</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DKS</td>
<td align="left">Salvin’s albatross</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DER</td>
<td align="left">Chatham Island albatross</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIC</td>
<td align="left">Grey-headed albatross</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DSB</td>
<td align="left">Southern Buller’s albatross</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DNB</td>
<td align="left">Northern Buller’s albatross</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PHU</td>
<td align="left">Sooty albatross</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PHE</td>
<td align="left">Light-mantled sooty albatross</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCI</td>
<td align="left">Grey petrel</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PRK</td>
<td align="left">Black petrel</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCW</td>
<td align="left">Westland petrel</td>
<td align="left">species</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PRO</td>
<td align="left">White-chinned petrel</td>
<td align="left">species</td>
<td align="right">13</td>
<td align="right">3</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCN</td>
<td align="left">Spectacled petrel</td>
<td align="left">species</td>
<td align="right">25</td>
<td align="right">1</td>
<td align="right">23</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DGA</td>
<td align="left">Gibson’s and Antipodean albatross</td>
<td align="left">complex</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DRA</td>
<td align="left">Royal albatrosses</td>
<td align="left">complex</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DYN</td>
<td align="left">Yellow-nosed albatrosses</td>
<td align="left">complex</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DST</td>
<td align="left">Shy-type albatross</td>
<td align="left">complex</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DBB</td>
<td align="left">Black-browed albatrosses</td>
<td align="left">complex</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIB</td>
<td align="left">Buller’s albatross</td>
<td align="left">complex</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DWC</td>
<td align="left">Wandering albatross complex</td>
<td align="left">complex</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PRZ</td>
<td align="left">Petrel complex</td>
<td align="left">complex</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIZ</td>
<td align="left">Diomedea spp</td>
<td align="left">genus</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">THZ</td>
<td align="left">Thalassarche spp</td>
<td align="left">genus</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PHZ</td>
<td align="left">Phoebetria spp</td>
<td align="left">genus</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PTZ</td>
<td align="left">Procellaria spp</td>
<td align="left">genus</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">ALZ</td>
<td align="left">Diomedeidae</td>
<td align="left">family</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PRX</td>
<td align="left">Procellariidae</td>
<td align="left">family</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">BLZ</td>
<td align="left">Bird</td>
<td align="left">bird</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Observed captures by species and fishery group</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lk_fishery_groups</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">captures_o</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">id_fishery_group</span>, <span class="va">code</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.</span>, n_captures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_captures</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">sp_groups</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">code</span>, <span class="va">common_name</span>, <span class="va">taxonomic_resolution</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tab</span>, by <span class="op">=</span> <span class="st">"code"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">lk_fishery_groups</span>, by <span class="op">=</span> <span class="st">"id_fishery_group"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">code</span>, <span class="va">common_name</span>, <span class="va">fishery_group</span>, <span class="va">n_captures</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span><span class="va">.</span>, id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">flag</span>, <span class="va">code</span>, <span class="va">common_name</span><span class="op">)</span>, names_from <span class="op">=</span> <span class="va">fishery_group</span>, values_from <span class="op">=</span> <span class="va">n_captures</span>, values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Add a totals column</span></span>
<span>  <span class="va">tab</span><span class="op">$</span><span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flag"</span>, <span class="st">"code"</span>, <span class="st">"common_name"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Drop flag from object used to create kable object</span></span>
<span>  <span class="va">observed_captures_by_code_fgroup</span> <span class="op">&lt;-</span> <span class="va">tab</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">-</span> <span class="va">flag</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Format numeric variables</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/numeric_table_format.html">numeric_table_format</a></span><span class="op">(</span><span class="va">.</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lk_fishery_groups</span><span class="op">$</span><span class="va">fishery_group</span>, <span class="st">"total"</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Set column names for kable object</span></span>
<span>  <span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_sentence</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">" "</span>, <span class="va">kbl_colnames</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">kbl_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Sum of observed captures by code and fishery group for "</span>, <span class="va">flag_str</span>, <span class="st">"."</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tab</span>, format <span class="op">=</span> <span class="st">'latex'</span>,</span>
<span>       col.names <span class="op">=</span> <span class="va">kbl_colnames</span>,</span>
<span>       row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       caption <span class="op">=</span> <span class="va">kbl_cap</span>,</span>
<span>       label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"observed_captures_by_code_fgroup"</span>, <span class="va">flag_str_label</span><span class="op">)</span>,</span>
<span>       align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="st">"l"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"r"</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       linesep <span class="op">=</span> <span class="st">""</span>, booktabs <span class="op">=</span> <span class="cn">TRUE</span>, escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">10</span>, latex_options <span class="op">=</span> <span class="st">"hold_position"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\toprule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\bottomrule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/save_kable.html" class="external-link">save_kable</a></span><span class="op">(</span><span class="va">tab</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_captures_by_code_fgroup.tex"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">observed_captures_by_code_fgroup</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_captures_by_code_fgroup.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="6%">
<col width="6%">
<col width="47%">
<col width="12%">
<col width="18%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left">flag</th>
<th align="left">code</th>
<th align="left">common_name</th>
<th align="right">Albacore</th>
<th align="right">Tropical Tuna</th>
<th align="right">total</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIW</td>
<td align="left">Gibson’s albatross</td>
<td align="right">8</td>
<td align="right">0</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DQS</td>
<td align="left">Antipodean albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIX</td>
<td align="left">Wandering albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DBN</td>
<td align="left">Tristan albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DAM</td>
<td align="left">Amsterdam albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIP</td>
<td align="left">Southern royal albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIQ</td>
<td align="left">Northern royal albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DCR</td>
<td align="left">Atlantic yellow-nosed albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TQH</td>
<td align="left">Indian yellow-nosed albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIM</td>
<td align="left">Black-browed albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TQW</td>
<td align="left">Campbell black-browed albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DCU</td>
<td align="left">Shy albatross</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TWD</td>
<td align="left">New Zealand white-capped albatross</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DKS</td>
<td align="left">Salvin’s albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DER</td>
<td align="left">Chatham Island albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIC</td>
<td align="left">Grey-headed albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DSB</td>
<td align="left">Southern Buller’s albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DNB</td>
<td align="left">Northern Buller’s albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PHU</td>
<td align="left">Sooty albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PHE</td>
<td align="left">Light-mantled sooty albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCI</td>
<td align="left">Grey petrel</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PRK</td>
<td align="left">Black petrel</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCW</td>
<td align="left">Westland petrel</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PRO</td>
<td align="left">White-chinned petrel</td>
<td align="right">0</td>
<td align="right">13</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCN</td>
<td align="left">Spectacled petrel</td>
<td align="right">0</td>
<td align="right">25</td>
<td align="right">25</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DGA</td>
<td align="left">Gibson’s and Antipodean albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DRA</td>
<td align="left">Royal albatrosses</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DYN</td>
<td align="left">Yellow-nosed albatrosses</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DST</td>
<td align="left">Shy-type albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DBB</td>
<td align="left">Black-browed albatrosses</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIB</td>
<td align="left">Buller’s albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DWC</td>
<td align="left">Wandering albatross complex</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PRZ</td>
<td align="left">Petrel complex</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIZ</td>
<td align="left">Diomedea spp</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">THZ</td>
<td align="left">Thalassarche spp</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PHZ</td>
<td align="left">Phoebetria spp</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PTZ</td>
<td align="left">Procellaria spp</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">ALZ</td>
<td align="left">Diomedeidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PRX</td>
<td align="left">Procellariidae</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">BLZ</td>
<td align="left">Bird</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Observed captures by species and time period</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lk_time_periods</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">captures_o</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">id_period</span>, <span class="va">code</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.</span>, n_captures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_captures</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">sp_groups</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">code</span>, <span class="va">common_name</span>, <span class="va">taxonomic_resolution</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tab</span>, by <span class="op">=</span> <span class="st">"code"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">lk_time_periods</span>, by <span class="op">=</span> <span class="st">"id_period"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">code</span>, <span class="va">common_name</span>, <span class="va">period</span>, <span class="va">n_captures</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span><span class="va">.</span>, id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">flag</span>, <span class="va">code</span>, <span class="va">common_name</span><span class="op">)</span>, names_from <span class="op">=</span> <span class="va">period</span>, values_from <span class="op">=</span> <span class="va">n_captures</span>, values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Add a totals column</span></span>
<span>  <span class="va">tab</span><span class="op">$</span><span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flag"</span>, <span class="st">"code"</span>, <span class="st">"common_name"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Drop flag from object used to create kable object</span></span>
<span>  <span class="va">observed_captures_by_code_period</span> <span class="op">&lt;-</span> <span class="va">tab</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">-</span> <span class="va">flag</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Format numeric variables</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/numeric_table_format.html">numeric_table_format</a></span><span class="op">(</span><span class="va">.</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lk_time_periods</span><span class="op">$</span><span class="va">period</span>, <span class="st">"total"</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Set column names for kable object</span></span>
<span>  <span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_sentence</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">" "</span>, <span class="va">kbl_colnames</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">kbl_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Sum of observed captures by code and period for "</span>, <span class="va">flag_str</span>, <span class="st">"."</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tab</span>, format <span class="op">=</span> <span class="st">'latex'</span>,</span>
<span>       col.names <span class="op">=</span> <span class="va">kbl_colnames</span>,</span>
<span>       row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       caption <span class="op">=</span> <span class="va">kbl_cap</span>,</span>
<span>       label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"observed_captures_by_code_period"</span>, <span class="va">flag_str_label</span><span class="op">)</span>,</span>
<span>       align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="st">"l"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"r"</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       linesep <span class="op">=</span> <span class="st">""</span>, booktabs <span class="op">=</span> <span class="cn">TRUE</span>, escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">10</span>, latex_options <span class="op">=</span> <span class="st">"hold_position"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\toprule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\bottomrule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/save_kable.html" class="external-link">save_kable</a></span><span class="op">(</span><span class="va">tab</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_captures_by_code_period.tex"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">observed_captures_by_code_period</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_captures_by_code_period.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">flag</th>
<th align="left">code</th>
<th align="left">common_name</th>
<th align="right">early</th>
<th align="right">late</th>
<th align="right">total</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIW</td>
<td align="left">Gibson’s albatross</td>
<td align="right">8</td>
<td align="right">0</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DQS</td>
<td align="left">Antipodean albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIX</td>
<td align="left">Wandering albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DBN</td>
<td align="left">Tristan albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DAM</td>
<td align="left">Amsterdam albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIP</td>
<td align="left">Southern royal albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIQ</td>
<td align="left">Northern royal albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DCR</td>
<td align="left">Atlantic yellow-nosed albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TQH</td>
<td align="left">Indian yellow-nosed albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIM</td>
<td align="left">Black-browed albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TQW</td>
<td align="left">Campbell black-browed albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DCU</td>
<td align="left">Shy albatross</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TWD</td>
<td align="left">New Zealand white-capped albatross</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DKS</td>
<td align="left">Salvin’s albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DER</td>
<td align="left">Chatham Island albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIC</td>
<td align="left">Grey-headed albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DSB</td>
<td align="left">Southern Buller’s albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DNB</td>
<td align="left">Northern Buller’s albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PHU</td>
<td align="left">Sooty albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PHE</td>
<td align="left">Light-mantled sooty albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCI</td>
<td align="left">Grey petrel</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PRK</td>
<td align="left">Black petrel</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCW</td>
<td align="left">Westland petrel</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PRO</td>
<td align="left">White-chinned petrel</td>
<td align="right">0</td>
<td align="right">13</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCN</td>
<td align="left">Spectacled petrel</td>
<td align="right">0</td>
<td align="right">25</td>
<td align="right">25</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DGA</td>
<td align="left">Gibson’s and Antipodean albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DRA</td>
<td align="left">Royal albatrosses</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DYN</td>
<td align="left">Yellow-nosed albatrosses</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DST</td>
<td align="left">Shy-type albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DBB</td>
<td align="left">Black-browed albatrosses</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIB</td>
<td align="left">Buller’s albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DWC</td>
<td align="left">Wandering albatross complex</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PRZ</td>
<td align="left">Petrel complex</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIZ</td>
<td align="left">Diomedea spp</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">THZ</td>
<td align="left">Thalassarche spp</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PHZ</td>
<td align="left">Phoebetria spp</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PTZ</td>
<td align="left">Procellaria spp</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">ALZ</td>
<td align="left">Diomedeidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PRX</td>
<td align="left">Procellariidae</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">BLZ</td>
<td align="left">Bird</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="summary-tables-of-observed-captures-by-species-group">Summary tables of observed captures by species group<a class="anchor" aria-label="anchor" href="#summary-tables-of-observed-captures-by-species-group"></a>
</h3>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Captures by species group (and capture status)</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">captures_o</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">id_species_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"captures"</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">sp_groups</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">id_species_group</span>, <span class="va">species_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">id_species_group</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tab</span>, by <span class="op">=</span> <span class="st">"id_species_group"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">species_group</span>, <span class="va">n_captures</span>, <span class="va">n_captures_alive</span>, <span class="va">n_captures_dead</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Drop flag from object used to create kable object</span></span>
<span><span class="va">observed_captures_by_species_group</span> <span class="op">&lt;-</span> <span class="va">tab</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">-</span> <span class="va">flag</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Format numeric variables</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/numeric_table_format.html">numeric_table_format</a></span><span class="op">(</span><span class="va">.</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n_captures"</span>, <span class="st">"n_captures_alive"</span>, <span class="st">"n_captures_dead"</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## New names:</span></span>
<span><span class="co">## New names:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">•</span> `` -&gt; `...1`</span></span>
<span><span class="co">## <span style="color: #00BBBB;">•</span> `` -&gt; `...2`</span></span>
<span><span class="co">## <span style="color: #00BBBB;">•</span> `` -&gt; `...3`</span></span></code></pre>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set column names for kable object</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"n_captures$"</span>, <span class="st">"Total"</span>, <span class="va">kbl_colnames</span><span class="op">)</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"n_captures_"</span>, <span class="st">""</span>, <span class="va">kbl_colnames</span><span class="op">)</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_sentence</a></span><span class="op">(</span><span class="va">kbl_colnames</span><span class="op">)</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">" "</span>, <span class="va">kbl_colnames</span><span class="op">)</span></span>
<span></span>
<span><span class="va">kbl_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Sum of observed captures by species group for "</span>, <span class="va">flag_str</span>, <span class="st">", including only captures identified to a species level."</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tab</span>, format <span class="op">=</span> <span class="st">'latex'</span>,</span>
<span>       col.names <span class="op">=</span> <span class="va">kbl_colnames</span>,</span>
<span>       row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       caption <span class="op">=</span> <span class="va">kbl_cap</span>,</span>
<span>       label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"observed_captures_by_species_group"</span>, <span class="va">flag_str_label</span><span class="op">)</span>,</span>
<span>       align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span><span class="op">)</span>,</span>
<span>       linesep <span class="op">=</span> <span class="st">""</span>, booktabs <span class="op">=</span> <span class="cn">TRUE</span>, escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">10</span>, latex_options <span class="op">=</span> <span class="st">"hold_position"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\toprule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\bottomrule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/save_kable.html" class="external-link">save_kable</a></span><span class="op">(</span><span class="va">tab</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_captures_by_species_group.tex"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">observed_captures_by_species_group</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_captures_by_species_group.rda"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="7%">
<col width="28%">
<col width="15%">
<col width="24%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">flag</th>
<th align="left">species_group</th>
<th align="right">n_captures</th>
<th align="right">n_captures_alive</th>
<th align="right">n_captures_dead</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">Wandering albatross</td>
<td align="right">8</td>
<td align="right">6</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">Royal albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">Small albatross</td>
<td align="right">10</td>
<td align="right">6</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">Sooty albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">Medium petrel</td>
<td align="right">38</td>
<td align="right">4</td>
<td align="right">33</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Observed captures by species group and fishery group</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lk_fishery_groups</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">captures_o</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">id_fishery_group</span>, <span class="va">id_species_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.</span>, n_captures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_captures</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">sp_groups</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">id_species_group</span>, <span class="va">species_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">id_species_group</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tab</span>, by <span class="op">=</span> <span class="st">"id_species_group"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">lk_fishery_groups</span>, by <span class="op">=</span> <span class="st">"id_fishery_group"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">species_group</span>, <span class="va">fishery_group</span>, <span class="va">n_captures</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span><span class="va">.</span>, id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">flag</span>, <span class="va">species_group</span><span class="op">)</span>, names_from <span class="op">=</span> <span class="va">fishery_group</span>, values_from <span class="op">=</span> <span class="va">n_captures</span>, values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Add a totals column</span></span>
<span>  <span class="va">tab</span><span class="op">$</span><span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flag"</span>, <span class="st">"species_group"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Drop flag from object used to create kable object</span></span>
<span>  <span class="va">observed_captures_by_group_fgroup</span> <span class="op">&lt;-</span> <span class="va">tab</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">-</span> <span class="va">flag</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Format numeric variables</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/numeric_table_format.html">numeric_table_format</a></span><span class="op">(</span><span class="va">.</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lk_fishery_groups</span><span class="op">$</span><span class="va">fishery_group</span>, <span class="st">"total"</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Set column names for kable object</span></span>
<span>  <span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_sentence</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">" "</span>, <span class="va">kbl_colnames</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">kbl_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Sum of observed captures by species group and fishery group for "</span>, <span class="va">flag_str</span>, <span class="st">", including only captures identified to a species level."</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tab</span>, format <span class="op">=</span> <span class="st">'latex'</span>,</span>
<span>       col.names <span class="op">=</span> <span class="va">kbl_colnames</span>,</span>
<span>       row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       caption <span class="op">=</span> <span class="va">kbl_cap</span>,</span>
<span>       label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"observed_captures_by_group_fgroup"</span>, <span class="va">flag_str_label</span><span class="op">)</span>,</span>
<span>       align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"r"</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       linesep <span class="op">=</span> <span class="st">""</span>, booktabs <span class="op">=</span> <span class="cn">TRUE</span>, escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">10</span>, latex_options <span class="op">=</span> <span class="st">"hold_position"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\toprule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\bottomrule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/save_kable.html" class="external-link">save_kable</a></span><span class="op">(</span><span class="va">tab</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_captures_by_group_fgroup.tex"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">observed_captures_by_group_fgroup</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_captures_by_group_fgroup.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">flag</th>
<th align="left">species_group</th>
<th align="right">Albacore</th>
<th align="right">Tropical Tuna</th>
<th align="right">total</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">Wandering albatross</td>
<td align="right">8</td>
<td align="right">0</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">Royal albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">Small albatross</td>
<td align="right">10</td>
<td align="right">0</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">Sooty albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">Medium petrel</td>
<td align="right">0</td>
<td align="right">38</td>
<td align="right">38</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Observed captures by species group and fishery group</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lk_time_periods</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">captures_o</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">id_period</span>, <span class="va">id_species_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.</span>, n_captures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_captures</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">sp_groups</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">id_species_group</span>, <span class="va">species_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">id_species_group</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tab</span>, by <span class="op">=</span> <span class="st">"id_species_group"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">lk_time_periods</span>, by <span class="op">=</span> <span class="st">"id_period"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">species_group</span>, <span class="va">period</span>, <span class="va">n_captures</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span><span class="va">.</span>, id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">flag</span>, <span class="va">species_group</span><span class="op">)</span>, names_from <span class="op">=</span> <span class="va">period</span>, values_from <span class="op">=</span> <span class="va">n_captures</span>, values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Add a totals column</span></span>
<span>  <span class="va">tab</span><span class="op">$</span><span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flag"</span>, <span class="st">"species_group"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Drop flag from object used to create kable object</span></span>
<span>  <span class="va">observed_captures_by_group_period</span> <span class="op">&lt;-</span> <span class="va">tab</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">-</span> <span class="va">flag</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Format numeric variables</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/numeric_table_format.html">numeric_table_format</a></span><span class="op">(</span><span class="va">.</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lk_time_periods</span><span class="op">$</span><span class="va">period</span>, <span class="st">"total"</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Set column names for kable object</span></span>
<span>  <span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_sentence</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">" "</span>, <span class="va">kbl_colnames</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">kbl_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Sum of observed captures by species group and period for "</span>, <span class="va">flag_str</span>, <span class="st">", including only captures identified to a species level."</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tab</span>, format <span class="op">=</span> <span class="st">'latex'</span>,</span>
<span>       col.names <span class="op">=</span> <span class="va">kbl_colnames</span>,</span>
<span>       row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       caption <span class="op">=</span> <span class="va">kbl_cap</span>,</span>
<span>       label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"observed_captures_by_group_period"</span>, <span class="va">flag_str_label</span><span class="op">)</span>,</span>
<span>       align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"r"</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       linesep <span class="op">=</span> <span class="st">""</span>, booktabs <span class="op">=</span> <span class="cn">TRUE</span>, escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">10</span>, latex_options <span class="op">=</span> <span class="st">"hold_position"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\toprule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\bottomrule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/save_kable.html" class="external-link">save_kable</a></span><span class="op">(</span><span class="va">tab</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_captures_by_group_period.tex"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">observed_captures_by_group_period</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_captures_by_group_period.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">flag</th>
<th align="left">species_group</th>
<th align="right">early</th>
<th align="right">late</th>
<th align="right">total</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">Wandering albatross</td>
<td align="right">8</td>
<td align="right">0</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">Royal albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">Small albatross</td>
<td align="right">10</td>
<td align="right">0</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">Sooty albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">Medium petrel</td>
<td align="right">0</td>
<td align="right">38</td>
<td align="right">38</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="summary-of-observed-captures-by-age-class">Summary of observed captures by age class<a class="anchor" aria-label="anchor" href="#summary-of-observed-captures-by-age-class"></a>
</h3>
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## get total captures by code</span></span>
<span><span class="va">tab_all</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/aggregate_captures.html">aggregate_captures</a></span><span class="op">(</span><span class="st">"flag"</span>, <span class="va">named_sp_codes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">.</span>, code <span class="op">=</span> <span class="va">group</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## get captures by code for each age class</span></span>
<span><span class="va">tab_adults</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter_captures.html">filter_captures</a></span><span class="op">(</span><span class="va">.</span>, field <span class="op">=</span> <span class="st">"age_class"</span>, condition <span class="op">=</span> <span class="st">"adult"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/aggregate_captures.html">aggregate_captures</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"flag"</span>, <span class="va">named_sp_codes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">.</span>, code <span class="op">=</span> <span class="va">group</span>, n_captures_adult <span class="op">=</span> <span class="va">n_captures</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tab_immatures</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter_captures.html">filter_captures</a></span><span class="op">(</span><span class="va">.</span>, field <span class="op">=</span> <span class="st">"age_class"</span>, condition <span class="op">=</span> <span class="st">"immature"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/aggregate_captures.html">aggregate_captures</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"flag"</span>, <span class="va">named_sp_codes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">.</span>, code <span class="op">=</span> <span class="va">group</span>, n_captures_immature <span class="op">=</span> <span class="va">n_captures</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tab_juveniles</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter_captures.html">filter_captures</a></span><span class="op">(</span><span class="va">.</span>, field <span class="op">=</span> <span class="st">"age_class"</span>, condition <span class="op">=</span> <span class="st">"juvenile"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/aggregate_captures.html">aggregate_captures</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"flag"</span>, <span class="va">named_sp_codes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">.</span>, code <span class="op">=</span> <span class="va">group</span>, n_captures_juvenile <span class="op">=</span> <span class="va">n_captures</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## combine in to a single table</span></span>
<span><span class="va">tab_all</span> <span class="op">&lt;-</span> <span class="va">tab_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tab_adults</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flag"</span>, <span class="st">"code"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tab_all</span> <span class="op">&lt;-</span> <span class="va">tab_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tab_immatures</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flag"</span>, <span class="st">"code"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tab_all</span> <span class="op">&lt;-</span> <span class="va">tab_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tab_juveniles</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flag"</span>, <span class="st">"code"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## add species name</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">sp_groups</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">code</span>, <span class="va">common_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tab_all</span>, by <span class="op">=</span> <span class="st">"code"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">code</span>, <span class="va">common_name</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"n_captures"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Drop flag from object used to create kable object</span></span>
<span><span class="va">observed_captures_by_code_age_class</span> <span class="op">&lt;-</span> <span class="va">tab</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">-</span> <span class="va">flag</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Format numeric variables</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/numeric_table_format.html">numeric_table_format</a></span><span class="op">(</span><span class="va">.</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n_captures"</span>, <span class="st">"n_captures_adult"</span>, <span class="st">"n_captures_immature"</span>, <span class="st">"n_captures_juvenile"</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## New names:</span></span>
<span><span class="co">## New names:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">•</span> `` -&gt; `...1`</span></span>
<span><span class="co">## <span style="color: #00BBBB;">•</span> `` -&gt; `...2`</span></span>
<span><span class="co">## <span style="color: #00BBBB;">•</span> `` -&gt; `...3`</span></span>
<span><span class="co">## <span style="color: #00BBBB;">•</span> `` -&gt; `...4`</span></span></code></pre>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set column names for kable object</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"n_captures$"</span>, <span class="st">"Total"</span>, <span class="va">kbl_colnames</span><span class="op">)</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"n_captures_"</span>, <span class="st">""</span>, <span class="va">kbl_colnames</span><span class="op">)</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_sentence</a></span><span class="op">(</span><span class="va">kbl_colnames</span><span class="op">)</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">" "</span>, <span class="va">kbl_colnames</span><span class="op">)</span></span>
<span></span>
<span><span class="va">kbl_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Sum of observed captures by code and age class for "</span>, <span class="va">flag_str</span>, <span class="st">"."</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tab</span>, format <span class="op">=</span> <span class="st">'latex'</span>,</span>
<span>       col.names <span class="op">=</span> <span class="va">kbl_colnames</span>,</span>
<span>       row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       caption <span class="op">=</span> <span class="va">kbl_cap</span>,</span>
<span>       label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"observed_captures_by_code_age_class"</span>, <span class="va">flag_str_label</span><span class="op">)</span>,</span>
<span>       align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="st">"l"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"r"</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       linesep <span class="op">=</span> <span class="st">""</span>, booktabs <span class="op">=</span> <span class="cn">TRUE</span>, escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">10</span>, latex_options <span class="op">=</span> <span class="st">"hold_position"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\toprule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\bottomrule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/save_kable.html" class="external-link">save_kable</a></span><span class="op">(</span><span class="va">tab</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_captures_by_code_age_class.tex"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">observed_captures_by_code_age_class</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_captures_by_code_age_class.rda"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="4%">
<col width="4%">
<col width="30%">
<col width="9%">
<col width="15%">
<col width="17%">
<col width="17%">
</colgroup>
<thead><tr class="header">
<th align="left">flag</th>
<th align="left">code</th>
<th align="left">common_name</th>
<th align="right">n_captures</th>
<th align="right">n_captures_adult</th>
<th align="right">n_captures_immature</th>
<th align="right">n_captures_juvenile</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIW</td>
<td align="left">Gibson’s albatross</td>
<td align="right">8</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DQS</td>
<td align="left">Antipodean albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIX</td>
<td align="left">Wandering albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DBN</td>
<td align="left">Tristan albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DAM</td>
<td align="left">Amsterdam albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIP</td>
<td align="left">Southern royal albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIQ</td>
<td align="left">Northern royal albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DCR</td>
<td align="left">Atlantic yellow-nosed albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TQH</td>
<td align="left">Indian yellow-nosed albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIM</td>
<td align="left">Black-browed albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TQW</td>
<td align="left">Campbell black-browed albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DCU</td>
<td align="left">Shy albatross</td>
<td align="right">6</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TWD</td>
<td align="left">New Zealand white-capped albatross</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DKS</td>
<td align="left">Salvin’s albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DER</td>
<td align="left">Chatham Island albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIC</td>
<td align="left">Grey-headed albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DSB</td>
<td align="left">Southern Buller’s albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DNB</td>
<td align="left">Northern Buller’s albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PHU</td>
<td align="left">Sooty albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PHE</td>
<td align="left">Light-mantled sooty albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCI</td>
<td align="left">Grey petrel</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PRK</td>
<td align="left">Black petrel</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCW</td>
<td align="left">Westland petrel</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PRO</td>
<td align="left">White-chinned petrel</td>
<td align="right">13</td>
<td align="right">11</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCN</td>
<td align="left">Spectacled petrel</td>
<td align="right">25</td>
<td align="right">9</td>
<td align="right">13</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DGA</td>
<td align="left">Gibson’s and Antipodean albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DRA</td>
<td align="left">Royal albatrosses</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DYN</td>
<td align="left">Yellow-nosed albatrosses</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DST</td>
<td align="left">Shy-type albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DBB</td>
<td align="left">Black-browed albatrosses</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIB</td>
<td align="left">Buller’s albatross</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DWC</td>
<td align="left">Wandering albatross complex</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PRZ</td>
<td align="left">Petrel complex</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIZ</td>
<td align="left">Diomedea spp</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">THZ</td>
<td align="left">Thalassarche spp</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PHZ</td>
<td align="left">Phoebetria spp</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PTZ</td>
<td align="left">Procellaria spp</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">ALZ</td>
<td align="left">Diomedeidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PRX</td>
<td align="left">Procellariidae</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">BLZ</td>
<td align="left">Bird</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="summary-tables-of-observed-overlap">Summary tables of observed overlap<a class="anchor" aria-label="anchor" href="#summary-tables-of-observed-overlap"></a>
</h3>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Observed overlap by species</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">overlap_o</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">id_species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"overlap"</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">sp_codes</span>, by <span class="op">=</span> <span class="st">"id_species"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">code</span>, <span class="va">common_name</span>, <span class="va">overlap</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Drop flag from object used to create kable object</span></span>
<span><span class="va">observed_overlap</span> <span class="op">&lt;-</span> <span class="va">tab</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">-</span> <span class="va">flag</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Format numeric variables</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/numeric_table_format.html">numeric_table_format</a></span><span class="op">(</span><span class="va">.</span>, names <span class="op">=</span> <span class="st">"overlap"</span>, digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set column names for kable object</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_sentence</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">" "</span>, <span class="va">kbl_colnames</span><span class="op">)</span></span>
<span><span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"Overlap"</span>, <span class="st">"Observed overlap"</span>, <span class="va">kbl_colnames</span><span class="op">)</span></span>
<span></span>
<span><span class="va">kbl_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Sum of observed overlap by species for "</span>, <span class="va">flag_str</span>, <span class="st">"."</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tab</span>, format <span class="op">=</span> <span class="st">'latex'</span>,</span>
<span>       col.names <span class="op">=</span> <span class="va">kbl_colnames</span>,</span>
<span>       row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       caption <span class="op">=</span> <span class="va">kbl_cap</span>,</span>
<span>       label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"observed_overlap"</span>, <span class="va">flag_str_label</span><span class="op">)</span>,</span>
<span>       align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"r"</span><span class="op">)</span>,</span>
<span>       linesep <span class="op">=</span> <span class="st">""</span>, booktabs <span class="op">=</span> <span class="cn">TRUE</span>, escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">10</span>, latex_options <span class="op">=</span> <span class="st">"hold_position"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\toprule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\bottomrule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/save_kable.html" class="external-link">save_kable</a></span><span class="op">(</span><span class="va">tab</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_overlap.tex"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">observed_overlap</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_overlap.rda"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">flag</th>
<th align="left">code</th>
<th align="left">common_name</th>
<th align="right">overlap</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIW</td>
<td align="left">Gibson’s albatross</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DQS</td>
<td align="left">Antipodean albatross</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIX</td>
<td align="left">Wandering albatross</td>
<td align="right">1.00e-06</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DBN</td>
<td align="left">Tristan albatross</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DAM</td>
<td align="left">Amsterdam albatross</td>
<td align="right">1.19e-04</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIP</td>
<td align="left">Southern royal albatross</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIQ</td>
<td align="left">Northern royal albatross</td>
<td align="right">1.00e-07</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DCR</td>
<td align="left">Atlantic yellow-nosed albatross</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TQH</td>
<td align="left">Indian yellow-nosed albatross</td>
<td align="right">5.27e-05</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIM</td>
<td align="left">Black-browed albatross</td>
<td align="right">6.40e-06</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TQW</td>
<td align="left">Campbell black-browed albatross</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DCU</td>
<td align="left">Shy albatross</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TWD</td>
<td align="left">New Zealand white-capped albatross</td>
<td align="right">5.00e-07</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DKS</td>
<td align="left">Salvin’s albatross</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DER</td>
<td align="left">Chatham Island albatross</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIC</td>
<td align="left">Grey-headed albatross</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DSB</td>
<td align="left">Southern Buller’s albatross</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DNB</td>
<td align="left">Northern Buller’s albatross</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PHU</td>
<td align="left">Sooty albatross</td>
<td align="right">6.30e-06</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PHE</td>
<td align="left">Light-mantled sooty albatross</td>
<td align="right">4.00e-07</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCI</td>
<td align="left">Grey petrel</td>
<td align="right">1.80e-06</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PRK</td>
<td align="left">Black petrel</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCW</td>
<td align="left">Westland petrel</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PRO</td>
<td align="left">White-chinned petrel</td>
<td align="right">2.90e-06</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCN</td>
<td align="left">Spectacled petrel</td>
<td align="right">0.00e+00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb153"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Observed overlap by species and fishery group</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lk_fishery_groups</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">overlap_o</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">id_fishery_group</span>, <span class="va">id_species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"overlap"</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">sp_codes</span>, by <span class="op">=</span> <span class="st">"id_species"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">lk_fishery_groups</span>, by <span class="op">=</span> <span class="st">"id_fishery_group"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">code</span>, <span class="va">common_name</span>, <span class="va">fishery_group</span>, <span class="va">overlap</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span><span class="va">.</span>, id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">flag</span>, <span class="va">code</span>, <span class="va">common_name</span><span class="op">)</span>, names_from <span class="op">=</span> <span class="va">fishery_group</span>, values_from <span class="op">=</span> <span class="va">overlap</span>, values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Add a totals column</span></span>
<span>  <span class="va">tab</span><span class="op">$</span><span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flag"</span>, <span class="st">"code"</span>, <span class="st">"common_name"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Drop flag from object used to create kable object</span></span>
<span>  <span class="va">observed_overlap_by_fgroup</span> <span class="op">&lt;-</span> <span class="va">tab</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">-</span> <span class="va">flag</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Format numeric variables</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/numeric_table_format.html">numeric_table_format</a></span><span class="op">(</span><span class="va">.</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lk_fishery_groups</span><span class="op">$</span><span class="va">fishery_group</span>, <span class="st">"total"</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Set column names for kable object</span></span>
<span>  <span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_sentence</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">" "</span>, <span class="va">kbl_colnames</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">kbl_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Observed overlap by species and fishery group for "</span>, <span class="va">flag_str</span>, <span class="st">"."</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tab</span>, format <span class="op">=</span> <span class="st">'latex'</span>,</span>
<span>       col.names <span class="op">=</span> <span class="va">kbl_colnames</span>,</span>
<span>       row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       caption <span class="op">=</span> <span class="va">kbl_cap</span>,</span>
<span>       label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"observed_overlap_by_fgroup"</span>, <span class="va">flag_str_label</span><span class="op">)</span>,</span>
<span>       align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="st">"l"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"r"</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       linesep <span class="op">=</span> <span class="st">""</span>, booktabs <span class="op">=</span> <span class="cn">TRUE</span>, escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">10</span>, latex_options <span class="op">=</span> <span class="st">"hold_position"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\toprule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\bottomrule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/save_kable.html" class="external-link">save_kable</a></span><span class="op">(</span><span class="va">tab</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_overlap_by_fgroup.tex"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">observed_overlap_by_fgroup</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_overlap_by_fgroup.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="6%">
<col width="6%">
<col width="45%">
<col width="11%">
<col width="18%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">flag</th>
<th align="left">code</th>
<th align="left">common_name</th>
<th align="right">Albacore</th>
<th align="right">Tropical Tuna</th>
<th align="right">total</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIW</td>
<td align="left">Gibson’s albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DQS</td>
<td align="left">Antipodean albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIX</td>
<td align="left">Wandering albatross</td>
<td align="right">0.00e+00</td>
<td align="right">1.00e-06</td>
<td align="right">1.00e-06</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DBN</td>
<td align="left">Tristan albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DAM</td>
<td align="left">Amsterdam albatross</td>
<td align="right">6.51e-05</td>
<td align="right">5.39e-05</td>
<td align="right">1.19e-04</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIP</td>
<td align="left">Southern royal albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIQ</td>
<td align="left">Northern royal albatross</td>
<td align="right">1.00e-07</td>
<td align="right">0.00e+00</td>
<td align="right">1.00e-07</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DCR</td>
<td align="left">Atlantic yellow-nosed albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TQH</td>
<td align="left">Indian yellow-nosed albatross</td>
<td align="right">3.30e-06</td>
<td align="right">4.95e-05</td>
<td align="right">5.27e-05</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIM</td>
<td align="left">Black-browed albatross</td>
<td align="right">1.00e-06</td>
<td align="right">5.30e-06</td>
<td align="right">6.40e-06</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TQW</td>
<td align="left">Campbell black-browed albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DCU</td>
<td align="left">Shy albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TWD</td>
<td align="left">New Zealand white-capped albatross</td>
<td align="right">5.00e-07</td>
<td align="right">0.00e+00</td>
<td align="right">5.00e-07</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DKS</td>
<td align="left">Salvin’s albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DER</td>
<td align="left">Chatham Island albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIC</td>
<td align="left">Grey-headed albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DSB</td>
<td align="left">Southern Buller’s albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DNB</td>
<td align="left">Northern Buller’s albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PHU</td>
<td align="left">Sooty albatross</td>
<td align="right">4.90e-06</td>
<td align="right">1.40e-06</td>
<td align="right">6.30e-06</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PHE</td>
<td align="left">Light-mantled sooty albatross</td>
<td align="right">0.00e+00</td>
<td align="right">4.00e-07</td>
<td align="right">4.00e-07</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCI</td>
<td align="left">Grey petrel</td>
<td align="right">5.00e-07</td>
<td align="right">1.30e-06</td>
<td align="right">1.80e-06</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PRK</td>
<td align="left">Black petrel</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCW</td>
<td align="left">Westland petrel</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PRO</td>
<td align="left">White-chinned petrel</td>
<td align="right">0.00e+00</td>
<td align="right">2.90e-06</td>
<td align="right">2.90e-06</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCN</td>
<td align="left">Spectacled petrel</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Observed overlap by species and period</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lk_time_periods</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">overlap_o</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">id_period</span>, <span class="va">id_species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"overlap"</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">sp_codes</span>, by <span class="op">=</span> <span class="st">"id_species"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">lk_time_periods</span>, by <span class="op">=</span> <span class="st">"id_period"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">flag</span>, <span class="va">code</span>, <span class="va">common_name</span>, <span class="va">period</span>, <span class="va">overlap</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span><span class="va">.</span>, id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">flag</span>, <span class="va">code</span>, <span class="va">common_name</span><span class="op">)</span>, names_from <span class="op">=</span> <span class="va">period</span>, values_from <span class="op">=</span> <span class="va">overlap</span>, values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Add a totals column</span></span>
<span>  <span class="va">tab</span><span class="op">$</span><span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flag"</span>, <span class="st">"code"</span>, <span class="st">"common_name"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Drop flag from object used to create kable object</span></span>
<span>  <span class="va">observed_overlap_by_period</span> <span class="op">&lt;-</span> <span class="va">tab</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">-</span> <span class="va">flag</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Format numeric variables</span></span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/numeric_table_format.html">numeric_table_format</a></span><span class="op">(</span><span class="va">.</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lk_time_periods</span><span class="op">$</span><span class="va">period</span>, <span class="st">"total"</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Set column names for kable object</span></span>
<span>  <span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_sentence</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">kbl_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">" "</span>, <span class="va">kbl_colnames</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">kbl_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Sum of observed overlap by period for "</span>, <span class="va">flag_str</span>, <span class="st">"."</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tab</span>, format <span class="op">=</span> <span class="st">'latex'</span>,</span>
<span>       col.names <span class="op">=</span> <span class="va">kbl_colnames</span>,</span>
<span>       row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       caption <span class="op">=</span> <span class="va">kbl_cap</span>,</span>
<span>       label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"observed_overlap_by_period"</span>, <span class="va">flag_str_label</span><span class="op">)</span>,</span>
<span>       align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="st">"l"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"r"</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       linesep <span class="op">=</span> <span class="st">""</span>, booktabs <span class="op">=</span> <span class="cn">TRUE</span>, escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">10</span>, latex_options <span class="op">=</span> <span class="st">"hold_position"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\toprule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\\\bottomrule"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/save_kable.html" class="external-link">save_kable</a></span><span class="op">(</span><span class="va">tab</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_overlap_by_period.tex"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">observed_overlap_by_period</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tables_path</span>, <span class="st">"observed_overlap_by_period.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="6%">
<col width="6%">
<col width="48%">
<col width="12%">
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="left">flag</th>
<th align="left">code</th>
<th align="left">common_name</th>
<th align="right">early</th>
<th align="right">late</th>
<th align="right">total</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIW</td>
<td align="left">Gibson’s albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DQS</td>
<td align="left">Antipodean albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIX</td>
<td align="left">Wandering albatross</td>
<td align="right">1.00e-06</td>
<td align="right">0.00e+00</td>
<td align="right">1.00e-06</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DBN</td>
<td align="left">Tristan albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DAM</td>
<td align="left">Amsterdam albatross</td>
<td align="right">6.47e-05</td>
<td align="right">5.44e-05</td>
<td align="right">1.19e-04</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIP</td>
<td align="left">Southern royal albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DIQ</td>
<td align="left">Northern royal albatross</td>
<td align="right">1.00e-07</td>
<td align="right">0.00e+00</td>
<td align="right">1.00e-07</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DCR</td>
<td align="left">Atlantic yellow-nosed albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TQH</td>
<td align="left">Indian yellow-nosed albatross</td>
<td align="right">2.60e-05</td>
<td align="right">2.67e-05</td>
<td align="right">5.27e-05</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIM</td>
<td align="left">Black-browed albatross</td>
<td align="right">3.10e-06</td>
<td align="right">3.20e-06</td>
<td align="right">6.40e-06</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TQW</td>
<td align="left">Campbell black-browed albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DCU</td>
<td align="left">Shy albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">TWD</td>
<td align="left">New Zealand white-capped albatross</td>
<td align="right">3.00e-07</td>
<td align="right">2.00e-07</td>
<td align="right">5.00e-07</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DKS</td>
<td align="left">Salvin’s albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DER</td>
<td align="left">Chatham Island albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DIC</td>
<td align="left">Grey-headed albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">DSB</td>
<td align="left">Southern Buller’s albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">DNB</td>
<td align="left">Northern Buller’s albatross</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PHU</td>
<td align="left">Sooty albatross</td>
<td align="right">3.60e-06</td>
<td align="right">2.60e-06</td>
<td align="right">6.30e-06</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PHE</td>
<td align="left">Light-mantled sooty albatross</td>
<td align="right">4.00e-07</td>
<td align="right">0.00e+00</td>
<td align="right">4.00e-07</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCI</td>
<td align="left">Grey petrel</td>
<td align="right">1.50e-06</td>
<td align="right">4.00e-07</td>
<td align="right">1.80e-06</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PRK</td>
<td align="left">Black petrel</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCW</td>
<td align="left">Westland petrel</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="even">
<td align="left">NZL</td>
<td align="left">PRO</td>
<td align="left">White-chinned petrel</td>
<td align="right">1.40e-06</td>
<td align="right">1.60e-06</td>
<td align="right">2.90e-06</td>
</tr>
<tr class="odd">
<td align="left">NZL</td>
<td align="left">PCN</td>
<td align="left">Spectacled petrel</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
<td align="right">0.00e+00</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="summary-figures-of-observed-effort">Summary figures of observed effort<a class="anchor" aria-label="anchor" href="#summary-figures-of-observed-effort"></a>
</h3>
<div class="sourceCode" id="cb155"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Map of overall observed effort</span></span>
<span></span>
<span><span class="co"># get observed effort by cell</span></span>
<span><span class="va">plt_dat</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">id_cell</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.</span>, observer_effort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">observer_effort</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add geometry from grid</span></span>
<span><span class="va">plt_dat</span> <span class="op">&lt;-</span> <span class="va">plt_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">grid</span>, by <span class="op">=</span> <span class="st">"id_cell"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate plot</span></span>
<span><span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plt_dat</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">observer_effort</span><span class="op">)</span>, col <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="st">"Observed\neffort"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/theme_sh.html">theme_sh</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"map_observed_effort_"</span>, <span class="va">flag_str_label</span>, <span class="st">".png"</span><span class="op">)</span>, plot <span class="op">=</span> <span class="va">plt</span>, device <span class="op">=</span> <span class="st">"png"</span>,</span>
<span>       path <span class="op">=</span> <span class="va">figures_path</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5</span>, units <span class="op">=</span> <span class="st">"in"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="make_inputs_files/figure-html/unnamed-chunk-110-1.png" alt="Figure - map of overall observed effort" width="480"><p class="caption">
Figure - map of overall observed effort
</p>
</div>
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Map of observed effort by month</span></span>
<span></span>
<span><span class="co"># get observed effort by cell</span></span>
<span><span class="va">plt_dat</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">id_cell</span>, <span class="va">id_month</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.</span>, observer_effort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">observer_effort</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add geometry from grid</span></span>
<span><span class="va">plt_dat</span> <span class="op">&lt;-</span> <span class="va">plt_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">grid</span>, by <span class="op">=</span> <span class="st">"id_cell"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate plot</span></span>
<span><span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plt_dat</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">observer_effort</span><span class="op">)</span>, col <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="st">"Observed\neffort"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">id_month</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">4</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/theme_sh.html">theme_sh</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"map_observed_effort_by_month_"</span>, <span class="va">flag_str_label</span>, <span class="st">".png"</span><span class="op">)</span>, plot <span class="op">=</span> <span class="va">plt</span>, device <span class="op">=</span> <span class="st">"png"</span>,</span>
<span>       path <span class="op">=</span> <span class="va">figures_path</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5</span>, units <span class="op">=</span> <span class="st">"in"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="make_inputs_files/figure-html/unnamed-chunk-112-1.png" alt="Figure - map of overall observed effort by month" width="480"><p class="caption">
Figure - map of overall observed effort by month
</p>
</div>
<div class="sourceCode" id="cb157"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Map of observed effort by fishery group</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lk_fishery_groups</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># get observed effort by cell</span></span>
<span>  <span class="va">plt_dat</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">id_cell</span>, <span class="va">id_fishery_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.</span>, observer_effort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">observer_effort</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">plt_dat</span> <span class="op">&lt;-</span> <span class="va">plt_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">lk_fishery_groups</span>, by <span class="op">=</span> <span class="st">"id_fishery_group"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># add geometry from grid</span></span>
<span>  <span class="va">plt_dat</span> <span class="op">&lt;-</span> <span class="va">plt_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">grid</span>, by <span class="op">=</span> <span class="st">"id_cell"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># generate plot</span></span>
<span>  <span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plt_dat</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">observer_effort</span><span class="op">)</span>, col <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="st">"Observed\neffort"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">fishery_group</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lk_fishery_groups</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/theme_sh.html">theme_sh</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"map_observed_effort_by_fgroup_"</span>, <span class="va">flag_str_label</span>, <span class="st">".png"</span><span class="op">)</span>, plot <span class="op">=</span> <span class="va">plt</span>, device <span class="op">=</span> <span class="st">"png"</span>,</span>
<span>         path <span class="op">=</span> <span class="va">figures_path</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lk_fishery_groups</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"in"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="figure">
<img src="make_inputs_files/figure-html/unnamed-chunk-114-1.png" alt="Figure - map of overall observed effort by fishery group" width="480"><p class="caption">
Figure - map of overall observed effort by fishery group
</p>
</div>
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Map of observed effort by time period</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lk_time_periods</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># get observed effort by cell</span></span>
<span>  <span class="va">plt_dat</span> <span class="op">&lt;-</span> <span class="va">obs_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">id_cell</span>, <span class="va">id_period</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.</span>, observer_effort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">observer_effort</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">plt_dat</span> <span class="op">&lt;-</span> <span class="va">plt_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">lk_time_periods</span>, by <span class="op">=</span> <span class="st">"id_period"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># add geometry from grid</span></span>
<span>  <span class="va">plt_dat</span> <span class="op">&lt;-</span> <span class="va">plt_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">grid</span>, by <span class="op">=</span> <span class="st">"id_cell"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># generate plot</span></span>
<span>  <span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plt_dat</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">observer_effort</span><span class="op">)</span>, col <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="st">"Observed\neffort"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">period</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lk_time_periods</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/theme_sh.html">theme_sh</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"map_observed_effort_by_period_"</span>, <span class="va">flag_str_label</span>, <span class="st">".png"</span><span class="op">)</span>, plot <span class="op">=</span> <span class="va">plt</span>, device <span class="op">=</span> <span class="st">"png"</span>,</span>
<span>         path <span class="op">=</span> <span class="va">figures_path</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lk_time_periods</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"in"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="figure">
<img src="make_inputs_files/figure-html/unnamed-chunk-116-1.png" alt="Figure - map of overall observed effort by time period" width="480"><p class="caption">
Figure - map of overall observed effort by time period
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="save-prepared-data">Save prepared data<a class="anchor" aria-label="anchor" href="#save-prepared-data"></a>
</h2>
<p>Save processed observer data at a raw (i.e., un-aggregated)
resolution:</p>
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">obs_data</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_data</span>, <span class="st">"obs_data.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">obs_overlap</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_data</span>, <span class="st">"obs_overlap.rda"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><code>obs_data</code> and <code>obs_overlap</code> are not required
as an input for the risk assessment model, but may be of interest to the
User.</p>
</div>
<div class="section level2">
<h2 id="save-inputs-to-the-risk-assessment-model">Save inputs to the risk assessment model<a class="anchor" aria-label="anchor" href="#save-inputs-to-the-risk-assessment-model"></a>
</h2>
<p>Save observed overlap:</p>
<div class="sourceCode" id="cb160"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">overlap_o</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_data</span>, <span class="st">"overlap_o.rda"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Save captures data:</p>
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">captures_o</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_data</span>, <span class="st">"captures_o.rda"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="issues-preparing-your-data">Issues preparing your data<a class="anchor" aria-label="anchor" href="#issues-preparing-your-data"></a>
</h2>
<p>If you encounter any issues preparing your observer dataset, please
create a new <a href="https://github.com/sefra-seabirds/sefraInputs/issues" class="external-link">Issue for
the <code>sefraInputs</code> Github repository</a> with a description of
the problem, including any error messages, and one of the project team
will assist.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Charles Edwards, Tom Peatman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
